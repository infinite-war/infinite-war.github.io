<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Java 多线程基础 | infinite-war の BLOG</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/assets/img/apple-touch-icon.png">
    <meta name="description" content="# Java多线程参考视频:BV1V4411p7EF并发相关概念已经学过，可以直接参考操作系统相关书籍，这里不再记录。CSDN:https://blog.csdn.net/INFINITE_WAR/article/details/122547019# 1.线程创建父类：Thread   (j ...">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#ffffff">
    <meta name="google-site-verification" content="DR-3xvCA7YBP7TIeg7__j5lxaniGh2pzocrfywyn8o0">
    <meta name="baidu-site-verification" content="zQef3H7nga">
    
    <link rel="preload" href="./assets/css/0.styles.ab82154a.css" as="style"><link rel="preload" href="./assets/js/app.152d2abe.js" as="script"><link rel="preload" href="./assets/js/5.45f84343.js" as="script"><link rel="preload" href="./assets/js/24.cd8025ea.js" as="script"><link rel="preload" href="./assets/js/10.e02dcdbc.js" as="script"><link rel="preload" href="./assets/js/7.6b3198e2.js" as="script"><link rel="prefetch" href="./assets/js/11.56ca4439.js"><link rel="prefetch" href="./assets/js/12.e7263128.js"><link rel="prefetch" href="./assets/js/13.6aa36547.js"><link rel="prefetch" href="./assets/js/14.17d1cb9e.js"><link rel="prefetch" href="./assets/js/15.74bd3f85.js"><link rel="prefetch" href="./assets/js/16.6cb58eaa.js"><link rel="prefetch" href="./assets/js/17.a2418203.js"><link rel="prefetch" href="./assets/js/18.0ce3e861.js"><link rel="prefetch" href="./assets/js/19.d38b8843.js"><link rel="prefetch" href="./assets/js/20.c056825b.js"><link rel="prefetch" href="./assets/js/21.55f4c10c.js"><link rel="prefetch" href="./assets/js/22.04dd41d1.js"><link rel="prefetch" href="./assets/js/23.1c3c301b.js"><link rel="prefetch" href="./assets/js/25.ba1b9f93.js"><link rel="prefetch" href="./assets/js/26.6682378c.js"><link rel="prefetch" href="./assets/js/27.b37436f6.js"><link rel="prefetch" href="./assets/js/28.a5979a1e.js"><link rel="prefetch" href="./assets/js/29.b5265440.js"><link rel="prefetch" href="./assets/js/3.9a5ec62e.js"><link rel="prefetch" href="./assets/js/30.3e2cac84.js"><link rel="prefetch" href="./assets/js/31.6c7014c4.js"><link rel="prefetch" href="./assets/js/32.3f06e55b.js"><link rel="prefetch" href="./assets/js/33.b1d68207.js"><link rel="prefetch" href="./assets/js/34.76d77190.js"><link rel="prefetch" href="./assets/js/35.4683a28e.js"><link rel="prefetch" href="./assets/js/36.9cf1d52f.js"><link rel="prefetch" href="./assets/js/37.3f6975cf.js"><link rel="prefetch" href="./assets/js/38.f88fc48d.js"><link rel="prefetch" href="./assets/js/39.f219d981.js"><link rel="prefetch" href="./assets/js/4.dfb684c6.js"><link rel="prefetch" href="./assets/js/40.ff3307ef.js"><link rel="prefetch" href="./assets/js/41.50e1e4a2.js"><link rel="prefetch" href="./assets/js/42.375a133d.js"><link rel="prefetch" href="./assets/js/43.a125d1e0.js"><link rel="prefetch" href="./assets/js/44.54249944.js"><link rel="prefetch" href="./assets/js/45.17c8ad02.js"><link rel="prefetch" href="./assets/js/46.1e1ff28c.js"><link rel="prefetch" href="./assets/js/47.805830d4.js"><link rel="prefetch" href="./assets/js/48.edec476d.js"><link rel="prefetch" href="./assets/js/49.44e0d779.js"><link rel="prefetch" href="./assets/js/50.f607e4f6.js"><link rel="prefetch" href="./assets/js/6.a2b9c671.js"><link rel="prefetch" href="./assets/js/8.0d136561.js"><link rel="prefetch" href="./assets/js/9.11f39998.js"><link rel="prefetch" href="./assets/js/vuejs-paginate.b3baa744.js">
    <link rel="stylesheet" href="./assets/css/0.styles.ab82154a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="GlobalLayout skin-jshine" data-v-5f6ffb84><!----> <div class="Launch" data-v-2d5332d6 data-v-5f6ffb84><div class="avatar" style="background-image:url('/assets/img/avatar.png');" data-v-2d5332d6></div></div> <div class="Spinner " data-v-4a1f0306 data-v-5f6ffb84></div> <div class="Header" data-v-a012f084 data-v-5f6ffb84><div class="ext " data-v-a012f084><i class="fas fa-cube" data-v-a012f084></i></div> <div class="sitename" data-v-a012f084><em><span>infinite-war's</span></em><strong><span>BLOG</span></strong></div> <div class="ext " data-v-a012f084><i class="fas fa-search" data-v-a012f084></i></div></div> <div class="Goingto" data-v-106a8802 data-v-5f6ffb84><div class="top" data-v-106a8802><i class="fas fa-arrow-up" data-v-106a8802></i></div> <div class="bottom" data-v-106a8802><i class="fas fa-arrow-down" data-v-106a8802></i></div></div> <div class="Addin" data-v-68b01994 data-v-5f6ffb84><div class="top " data-v-68b01994><i class="fas fa-ad" data-v-68b01994></i></div> <div class="bottom " data-v-68b01994><i class="fas fa-qrcode" data-v-68b01994></i></div> <!----></div> <!----> <div class="frame" data-v-5f6ffb84><div class="main" data-v-5f6ffb84><div class="drawer" data-v-5f6ffb84><div class="Drawer" data-v-68407f5a data-v-5f6ffb84><div class="Brand card" data-v-bb741bc0 data-v-68407f5a><div class="caption ifSmallest" data-v-bb741bc0><span class="icon" data-v-bb741bc0><i class="fas fa-id-card fa-fw" data-v-bb741bc0></i></span> <span data-v-bb741bc0>CARD</span></div> <div class="avatar" style="background-image:url('/assets/img/brand.png');" data-v-bb741bc0></div> <div class="inner" data-v-bb741bc0><div class="author" data-v-bb741bc0>Mitchell</div> <div class="signature" data-v-bb741bc0>issue, func, flow, std, solve</div> <div class="counter" data-v-bb741bc0><span title="Count of Posts" data-v-bb741bc0><i class="fas fa-archive fa-fw" data-v-bb741bc0></i>
        30 </span>|
      <span title="Count of Categories" data-v-bb741bc0><i class="fas fa-folder-open fa-fw" data-v-bb741bc0></i>
        15 </span>|
      <span title="Count of Tags" data-v-bb741bc0><i class="fas fa-tags fa-fw" data-v-bb741bc0></i>
        22
      </span></div> <div class="contact" data-v-bb741bc0><a target="_blank" href="https://github.com/infinite-war" title="infinite-war" data-v-bb741bc0><i class="fab fa-github fa-fw"></i></a><a target="_blank" href="mailto://969557028@qq.com" title="969557028@qq.com" data-v-bb741bc0><i class="fas fa-envelope fa-fw"></i></a><a target="_blank" href="tencent://Message/?uin=969557028" title="969557028" data-v-bb741bc0><i class="fab fa-qq fa-fw"></i></a></div></div> <div class="minimize ifSmallest" data-v-bb741bc0></div></div> <div class="Menu" data-v-098eaa92 data-v-68407f5a><div class="card" data-v-098eaa92><div class="caption" data-v-098eaa92><span class="icon" data-v-098eaa92><i class="fas fa-sitemap fa-fw"></i></span> <span data-v-098eaa92>MENU</span></div> <div class="inner" data-v-098eaa92><a href="/" class="router-link-active" data-v-098eaa92><span class="icon" data-v-098eaa92><i class="fas fa-home fa-fw"></i></span> <span data-v-098eaa92>Home</span></a><a href="/archive/" data-v-098eaa92><span class="icon" data-v-098eaa92><i class="fas fa-archive fa-fw"></i></span> <span data-v-098eaa92>Archive</span></a><a href="/codes/" data-v-098eaa92><span class="icon" data-v-098eaa92><i class="fas fa-box fa-fw"></i></span> <span data-v-098eaa92>Code Library</span></a><a href="/icons/" data-v-098eaa92><span class="icon" data-v-098eaa92><i class="fas fa-icons fa-fw"></i></span> <span data-v-098eaa92>Icon Font Library</span></a><a href="/records/" data-v-098eaa92><span class="icon" data-v-098eaa92><i class="fas fa-edit fa-fw"></i></span> <span data-v-098eaa92>Records</span></a><a href="/gallery/" data-v-098eaa92><span class="icon" data-v-098eaa92><i class="fas fa-images fa-fw"></i></span> <span data-v-098eaa92>Gallery</span></a><a href="/resume/" data-v-098eaa92><span class="icon" data-v-098eaa92><i class="fas fa-paper-plane fa-fw"></i></span> <span data-v-098eaa92>Resume Tips</span></a><a href="/letter/" data-v-098eaa92><span class="icon" data-v-098eaa92><i class="fas fa-file-contract fa-fw"></i></span> <span data-v-098eaa92>Cover Letter Tips</span></a><a href="/about/" data-v-098eaa92><span class="icon" data-v-098eaa92><i class="fas fa-user fa-fw"></i></span> <span data-v-098eaa92>About</span></a></div> <div class="minimize" data-v-098eaa92></div></div></div> <div class="Skin card" data-v-5752a7b7 data-v-68407f5a><div class="caption" data-v-5752a7b7><span class="icon" data-v-5752a7b7><i class="fas fa-tshirt fa-fw" data-v-5752a7b7></i></span> <span data-v-5752a7b7>SKIN</span></div> <div class="inner" data-v-5752a7b7><div title="Default" class="color " style="background:#696969;" data-v-5752a7b7></div><div title="White &amp; Black" class="color " style="background:linear-gradient(120deg, #666666, #999999, #333333);" data-v-5752a7b7></div><div title="JShine" class="color active" style="background:linear-gradient(120deg, #ff3300, #cc66ff, #00ccff);" data-v-5752a7b7></div><div title="Memariani" class="color " style="background:linear-gradient(120deg, #cc6699, #6666cc, #33cccc);" data-v-5752a7b7></div></div> <div class="minimize" data-v-5752a7b7></div></div> <div class="Settings card" data-v-8ef0d620 data-v-68407f5a><div class="caption" data-v-8ef0d620><span class="icon" data-v-8ef0d620><i class="fas fa-cog fa-fw" data-v-8ef0d620></i></span> <span data-v-8ef0d620>SETTINGS</span></div> <div class="inner" data-v-8ef0d620><div class=" " data-v-8ef0d620><span class="icon" data-v-8ef0d620><i class="fas fa-adjust fa-fw"></i></span> <span data-v-8ef0d620>Night Shift</span> <div class="switch" data-v-8ef0d620></div></div><div class=" " data-v-8ef0d620><span class="icon" data-v-8ef0d620><i class="fas fa-video-slash fa-fw"></i></span> <span data-v-8ef0d620>Disable Canvas</span> <div class="switch" data-v-8ef0d620></div></div><div class="active " data-v-8ef0d620><span class="icon" data-v-8ef0d620><i class="fas fa-globe-asia fa-fw"></i></span> <span data-v-8ef0d620>简体中文</span> <div class="switch" data-v-8ef0d620></div></div></div> <div class="minimize" data-v-8ef0d620></div></div></div></div> <div class="center " data-v-5f6ffb84><div class="Translate card" data-v-bbd4da56 data-v-5f6ffb84><div class="bar " data-v-bbd4da56><div title="Highlight words to translate - Supported by Baidu Translation API" class="sq highlight" data-v-bbd4da56><i class="fas fa-highlighter" data-v-bbd4da56></i></div> <div class="locales" data-v-bbd4da56><div data-v-bbd4da56>中文</div> <span data-v-bbd4da56>|</span> <div data-v-bbd4da56>English</div> <span data-v-bbd4da56>|</span> <div data-v-bbd4da56>日本語</div> <!----></div> <div title="Click to copy highlighted content above translation bar" class="sq copy" data-v-bbd4da56><i class="fas fa-copy" data-v-bbd4da56></i></div></div> <!----></div> <div data-v-5f6ffb84><div class="Post" data-v-55aed3a6 data-v-5f6ffb84><div class="Article card fix " data-v-3caaac61 data-v-55aed3a6><div class="caption" data-v-3caaac61><span class="icon" data-v-3caaac61><i class="fas fa-file fa-fw" data-v-3caaac61></i></span> <span data-v-3caaac61>PAGE CONTENT</span></div> <div class="inner" data-v-3caaac61><div class="meta  " data-v-3caaac61><div class="meta-title" data-v-3caaac61>Java 多线程基础</div> <div class="meta-info" data-v-3caaac61><div class="info-date" data-v-3caaac61><i class="fas fa-calendar-alt fa-fw" data-v-3caaac61></i>
          2022-01-17
        </div> <div class="info-updated" data-v-3caaac61><i class="fas fa-calendar-check fa-fw" data-v-3caaac61></i>
          2022-01-17
        </div> <div class="info-categories" data-v-3caaac61><i class="fas fa-folder-open fa-fw" data-v-3caaac61></i> <span data-v-3caaac61><!----> <a href="/category/语言/" data-v-3caaac61>语言</a></span></div> <div class="info-wordcount" data-v-3caaac61><i class="fas fa-file-word fa-fw" data-v-3caaac61></i>
          6.3k
        </div> <div class="info-wordcount" data-v-3caaac61><i class="fas fa-stopwatch fa-fw" data-v-3caaac61></i>
          51 min.
        </div></div></div> <div class="markdown-body content__default" data-v-3caaac61><h1 id="java多线程"><a href="#java多线程" class="header-anchor">#</a> Java多线程</h1> <p>参考视频:</p> <p>BV1V4411p7EF</p> <p>并发相关概念已经学过，可以直接参考操作系统相关书籍，这里不再记录。</p> <p>CSDN:https://blog.csdn.net/INFINITE_WAR/article/details/122547019</p> <h1 id="_1-线程创建"><a href="#_1-线程创建" class="header-anchor">#</a> 1.线程创建</h1> <p>父类：Thread   (java.lang.Thread)
接口：Runnable、Callable</p> <h2 id="_1-1-创建thread"><a href="#_1-1-创建thread" class="header-anchor">#</a> 1.1 创建Thread</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token class-name">Multics</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//run方法线程体</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">20</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;吃饭&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//主线程</span>

        <span class="token comment">//创建一个线程对象</span>
        <span class="token class-name">TestThread</span> testThread<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">TestThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//调用start()方法开启线程。调用run()方法不会实现并发</span>
        testThread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">40</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;看电视&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/184e9b96564944b0aa5a5f8395bc50f5.png#pic_center" loading="lazy" class="lazy"></p> <p>注：每次执行结果可能不一样</p> <h2 id="_1-2-多线程网图下载"><a href="#_1-2-多线程网图下载" class="header-anchor">#</a> 1.2 多线程网图下载</h2> <p>可用工具包：https://commons.apache.org/proper/commons-io/download_io.cgi</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token class-name">Multics</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileUtils</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>URL<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> url<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">TestThread</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>url <span class="token operator">=</span> url<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//下载图片执行体</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">WebDownloader</span> webDownloader<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">WebDownloader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        webDownloader<span class="token punctuation">.</span><span class="token function">downloader</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;下载的文件名为：&quot;</span><span class="token operator">+</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">TestThread</span> t1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">TestThread</span><span class="token punctuation">(</span><span class="token string">&quot;https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fup.enterdesk.com%2Fedpic_source%2F1d%2Fd7%2F74%2F1dd7742b0e08837f0afb77d3c9006a75.jpg&amp;refer=http%3A%2F%2Fup.enterdesk.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1644976584&amp;t=c01c909514022ae483b88d1f5570fe2d&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;1.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TestThread</span> t2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">TestThread</span><span class="token punctuation">(</span><span class="token string">&quot;https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic1.win4000.com%2Fwallpaper%2F2020-11-06%2F5fa4dec85d63f.jpg&amp;refer=http%3A%2F%2Fpic1.win4000.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1644976692&amp;t=f0ec64a96d2eba5ebd5942bd42381e53&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;2.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TestThread</span> t3<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">TestThread</span><span class="token punctuation">(</span><span class="token string">&quot;https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.3dmgame.com%2Fuploads%2Fimages%2Fnews%2F20200701%2F1593590839_180447.jpg&amp;refer=http%3A%2F%2Fimg.3dmgame.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1644976721&amp;t=6d631b3087b6a7ef424b4d7c74e1aa15&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;3.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>


<span class="token comment">//下载器</span>
<span class="token keyword">class</span> <span class="token class-name">WebDownloader</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">downloader</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">,</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">FileUtils</span><span class="token punctuation">.</span><span class="token function">copyURLToFile</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">URL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;downloader方法出现IO异常&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/d5a74a2627374d578e867a5aea0ff0dc.png?x-oss-process=image" loading="lazy" class="lazy"></p> <h2 id="_1-3-实现runnable接口"><a href="#_1-3-实现runnable接口" class="header-anchor">#</a> 1.3 实现Runnable接口</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 1.1创建Thread改写</span>
<span class="token keyword">package</span> <span class="token class-name">Multics</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//run方法线程体</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">20</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;吃饭&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//创建Runnable接口的实现类对象</span>
        <span class="token class-name">TestThread</span> testThread1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">TestThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//创建线程对象，通过线程对象来开启线程，又称代理</span>
        <span class="token class-name">Thread</span> thread<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>testThread1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//上面两行也可以简写成  new Thread(testThread1).start();</span>

        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">40</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;看电视&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token class-name">Multics</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileUtils</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>URL<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">{</span>
    
    <span class="token comment">//......</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//创建t1,t2,t3</span>
		<span class="token comment">//......</span>
        
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>t2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>t3<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>


<span class="token comment">//下载器</span>
<span class="token comment">//......</span>
</code></pre></div><table><thead><tr><th>继承Thread类</th> <th>实现Runnable接口</th></tr></thead> <tbody><tr><td>子类继承Thread类具备多线程能力</td> <td>实现接口Runnable具有多线程能力</td></tr> <tr><td>启动线程：子类对象.start()</td> <td>启动线程：传入目标对象+Thread对象.start()</td></tr> <tr><td>不建议使用：避免OOP单继承局限性</td> <td>推荐使用：避免单继承的局限性，灵活方便，便于同一个对象被多个线程使用</td></tr></tbody></table> <h2 id="_1-4-实现callable接口-次要"><a href="#_1-4-实现callable接口-次要" class="header-anchor">#</a> 1.4 实现Callable接口（次要）</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token class-name">Multics</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileUtils</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>URL<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token comment">/**
*  1.2网图下载改写
*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestThread</span> <span class="token keyword">implements</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> url<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">TestThread</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>url <span class="token operator">=</span> url<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//下载图片执行体</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">WebDownloader</span> webDownloader<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">WebDownloader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        webDownloader<span class="token punctuation">.</span><span class="token function">downloader</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;下载的文件名为：&quot;</span><span class="token operator">+</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token comment">//创建t1,t2,t3</span>
        <span class="token comment">//......</span>
        
        
        <span class="token comment">//创建执行服务</span>
        <span class="token class-name">ExecutorService</span> ser<span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//线程池</span>

        <span class="token comment">//提交执行</span>
        <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> r1<span class="token operator">=</span>ser<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> r2<span class="token operator">=</span>ser<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>t2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> r3<span class="token operator">=</span>ser<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>t3<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//获取结果</span>
        <span class="token keyword">boolean</span> rs1<span class="token operator">=</span>r1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> rs2<span class="token operator">=</span>r2<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> rs3<span class="token operator">=</span>r3<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//关闭服务</span>
        ser<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">//下载器</span>
<span class="token comment">//......</span>
</code></pre></div><p>实现Callable接口的好处：</p> <ol><li>可以定义返回值</li> <li>可以抛出异常</li></ol> <h2 id="例子-购买火车票"><a href="#例子-购买火车票" class="header-anchor">#</a> 例子：购买火车票</h2> <p>多个线程操作同一个对象</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token class-name">Multics</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileUtils</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>URL<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">{</span>

    <span class="token comment">//剩余票数</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> ticketNums<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ticketNums<span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">//模拟延时</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;--&gt;拿到了第：&quot;</span><span class="token operator">+</span>ticketNums<span class="token operator">--</span><span class="token operator">+</span><span class="token string">&quot;张票&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">TestThread</span> ticket<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">TestThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>ticket<span class="token punctuation">,</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>ticket<span class="token punctuation">,</span><span class="token string">&quot;李四&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>ticket<span class="token punctuation">,</span><span class="token string">&quot;黄牛&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/c270924911b9474eb9d83821502029bd.png?x-oss-process=image" loading="lazy" class="lazy"></p> <p>由结果可以看出，多线程代码可能会出现数据不安全的问题。需要用并发方法解决。</p> <h2 id="例子-龟兔赛跑"><a href="#例子-龟兔赛跑" class="header-anchor">#</a> 例子：龟兔赛跑</h2> <p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/9c50185ba72e448986bb5725bbf0ab1b.png?x-oss-process=image" loading="lazy" class="lazy"></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token class-name">Multics</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Race</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> winner<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">100</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

            <span class="token comment">//模拟兔子偷懒</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;兔子&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> i<span class="token operator">%</span><span class="token number">30</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token comment">//判断比赛是否结束</span>
            <span class="token keyword">boolean</span> flag<span class="token operator">=</span><span class="token function">gameOver</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token punctuation">}</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;--&gt;已经跑了&quot;</span><span class="token operator">+</span>i<span class="token operator">+</span><span class="token string">&quot;步&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//判断是否完成比赛</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">gameOver</span><span class="token punctuation">(</span><span class="token keyword">int</span> steps<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//判断胜利者</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>winner<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>steps<span class="token operator">==</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            winner<span class="token operator">=</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;winner is &quot;</span><span class="token operator">+</span>winner<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Race</span> race<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Race</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>race<span class="token punctuation">,</span><span class="token string">&quot;兔子&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>race<span class="token punctuation">,</span><span class="token string">&quot;乌龟&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/c14d033cbf5042e89cefb312b8328e7e.png#pic_center" loading="lazy" class="lazy"></p> <h2 id="_1-5-静态代理模式"><a href="#_1-5-静态代理模式" class="header-anchor">#</a> 1.5 静态代理模式</h2> <p>真实目标角色和代理角色实现同一个接口。换句话说，真实目标角色可以只实现很小一部分的接口内容，接口的大部分内容可以放到代理角色中实现。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token class-name">Multics</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StaticProxy</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token class-name">WeddingCompany</span> weddingCompany<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">WeddingCompany</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">You</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token namespace">weddingCompany<span class="token punctuation">.</span></span>HappyMarry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">Marry</span><span class="token punctuation">{</span>
    <span class="token comment">//一些待实现接口</span>
    <span class="token comment">//结婚内容1</span>
    <span class="token comment">//结婚内容2</span>
    <span class="token comment">//结婚内容3</span>
    <span class="token comment">//结婚内容4</span>

    <span class="token keyword">void</span> <span class="token class-name">HappyMarry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">You</span> <span class="token keyword">implements</span> <span class="token class-name">Marry</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">HappyMarry</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;秦老师要结婚了，超开心&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//婚庆公司类</span>
<span class="token keyword">class</span> <span class="token class-name">WeddingCompany</span> <span class="token keyword">implements</span> <span class="token class-name">Marry</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Marry</span> target<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">WeddingCompany</span><span class="token punctuation">(</span><span class="token class-name">Marry</span> target<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>target<span class="token operator">=</span>target<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">HappyMarry</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token namespace">this<span class="token punctuation">.</span>target<span class="token punctuation">.</span></span>HappyMarry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;结婚之后，收尾款&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;结婚之前，布置现场&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//还可以实现Marry中的其他接口</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="lambda表达式"><a href="#lambda表达式" class="header-anchor">#</a> Lambda表达式</h2> <p>目的：避免匿名内部类定义过多。可以将几乎不常用(比如只在一个地方用过一次)的函数直接写成lambda函数。大体思想和C++的lambda表达式相同。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//三种定义方式</span>
<span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token operator">-&gt;</span>expression<span class="token punctuation">[</span>表达式<span class="token punctuation">]</span>
<span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token operator">-&gt;</span>statement<span class="token punctuation">[</span>语句<span class="token punctuation">]</span>
<span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>statements<span class="token punctuation">}</span>

<span class="token comment">//例</span>
a<span class="token operator">-&gt;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;i like lambda --&gt;&quot;</span><span class="token operator">+</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token class-name">Multics</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestLambda</span> <span class="token punctuation">{</span>
    <span class="token comment">//3.静态内部类</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Like2</span> <span class="token keyword">implements</span> <span class="token class-name">ILike</span><span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;i like lambda2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ILike</span> like<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Like</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        like<span class="token punctuation">.</span><span class="token function">lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        like<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Like2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        like<span class="token punctuation">.</span><span class="token function">lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment">//4.局部内部类</span>
        <span class="token keyword">class</span> <span class="token class-name">Like3</span> <span class="token keyword">implements</span> <span class="token class-name">ILike</span><span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;i like lambda3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        like<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Like3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        like<span class="token punctuation">.</span><span class="token function">lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//5.匿名内部类,通过接口声明</span>
        like<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ILike</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;i like lambda4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">//6.用lambda简化</span>
        like<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;i like lambda5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        like<span class="token punctuation">.</span><span class="token function">lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//1.定义一个函数式接口</span>
<span class="token keyword">interface</span> <span class="token class-name">ILike</span><span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//2.实现类</span>
<span class="token keyword">class</span> <span class="token class-name">Like</span> <span class="token keyword">implements</span> <span class="token class-name">ILike</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;i like lambda&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注：</p> <ul><li>函数式接口说明接口内只有一个待实现的方法，加入ILike中写了两个待实现方法，那么用lambda表达式就会报错。</li> <li>lambda表达式中的参数可以不声明类型。</li></ul> <h1 id="_2-线程操作"><a href="#_2-线程操作" class="header-anchor">#</a> 2.线程操作</h1> <h2 id="_2-0-java线程基本内容"><a href="#_2-0-java线程基本内容" class="header-anchor">#</a> 2.0 Java线程基本内容</h2> <p>常见线程方法</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token function">setPriority</span><span class="token punctuation">(</span><span class="token keyword">int</span> newPriority<span class="token punctuation">)</span>  <span class="token comment">//更改线程的优先级</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token keyword">long</span> millis<span class="token punctuation">)</span>  <span class="token comment">//指定毫秒内停止当前线程</span>
<span class="token keyword">void</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//等待该线程终止</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token keyword">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//暂停当前正在执行的线程对象，并执行其他线程</span>
<span class="token keyword">void</span> <span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//中断线程</span>
<span class="token keyword">boolean</span> <span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//测试线程是否处于活动状态</span>
</code></pre></div><p>线程状态常量  --&gt;Thread.State.常量：</p> <ul><li><code>NEW</code>：尚未启动的线程</li> <li><code>RUNNABLE</code>:  在Java虚拟机中处于就绪态的线程</li> <li><code>BLOCKED</code>:  线程处于阻塞态</li> <li><code>WAITING</code>:  线程正在等待另一个线程执行特定动作</li> <li><code>TIMED_WAITING</code>：正在等待另一个线程执行动作达到指定等待时间的线程</li> <li><code>TERMINATED</code>：结束态</li></ul> <h2 id="_2-1-线程停止"><a href="#_2-1-线程停止" class="header-anchor">#</a> 2.1 线程停止</h2> <ul><li>建议线程正常停止。不建议死循环。</li> <li>建议使用自定义的标志位，用于判断线程是否停止</li> <li>不要使用stop()或destory()等JDK已不建议使用的方法</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token class-name">Multics</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestStop</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">{</span>

    <span class="token comment">//1.设置一个标志位</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> flag<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;run......Thread&quot;</span><span class="token operator">+</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//2.设置一个公开的方法停止线程，转换标志位</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>flag<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">TestStop</span> testStop<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">TestStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>testStop<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">1000</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;测试&quot;</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">==</span><span class="token number">900</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                testStop<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;线程强制停止&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/0ef97546f36b4129b02457ecb059114c.png#pic_center" loading="lazy" class="lazy"></p> <h2 id="_2-2-线程休眠"><a href="#_2-2-线程休眠" class="header-anchor">#</a> 2.2 线程休眠</h2> <ul><li>sleep存在异常InterruptedException</li> <li>sleep事件结束后线程进入就绪态</li> <li>每个对象都有一个锁，sleep不会释放锁</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token class-name">Multics</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">SimpleDateFormat</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span>

<span class="token comment">//模拟网络延时</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestSleep</span><span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">turnDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">{</span>
        <span class="token keyword">int</span> num<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>num<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>num<span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Date</span> startTime<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取系统当前时间</span>

        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>startTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                startTime<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//更新当前时间</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/0af4b466fdbb416595bab74e62212832.png#pic_center" loading="lazy" class="lazy"></p> <h2 id="_2-3-线程礼让"><a href="#_2-3-线程礼让" class="header-anchor">#</a> 2.3 线程礼让</h2> <p>目的：让当前正在执行的线程暂停，但不进入阻塞态。这个过程不一定成功。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token class-name">Multics</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestYield</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">MyYield</span> myYield<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">MyYield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>myYield<span class="token punctuation">,</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>myYield<span class="token punctuation">,</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">class</span> <span class="token class-name">MyYield</span> <span class="token keyword">implements</span>  <span class="token class-name">Runnable</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;线程开始执行&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token keyword">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//礼让</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;线程停止执行&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/ef6845c28e94490680668054f2fa6650.png#pic_center" loading="lazy" class="lazy"></p> <h2 id="_2-4-线程强制执行"><a href="#_2-4-线程强制执行" class="header-anchor">#</a> 2.4 线程强制执行</h2> <p>join()</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token class-name">Multics</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestJoin</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">1000</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;线程vip来了&quot;</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">{</span>
        <span class="token comment">//启动线程</span>
        <span class="token class-name">TestJoin</span> testJoin<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">TestJoin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> thread<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>testJoin<span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//主线程</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">500</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">==</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">//i==200是有一个vip线程插队</span>
                thread<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;main&quot;</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/e3c05f399ca04b38a26ed4e8ef93d870.png?x-oss-process=image" loading="lazy" class="lazy"></p> <h2 id="_2-5-线程优先级"><a href="#_2-5-线程优先级" class="header-anchor">#</a> 2.5 线程优先级</h2> <p>优先级用数字表示：1~10</p> <ul><li>Thread.MIN_PRIOTITY=1;</li> <li>Thread.MAX_PRIOTITY=10;   //最高优先级</li> <li>Thread.NORM_PRIOTITY=5;</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token function">getPriority</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">//获取优先级 </span>
<span class="token function">setPriority</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span>  <span class="token comment">//在线程启动前 设置优先级</span>
</code></pre></div><h2 id="_2-6-守护-daemon-线程"><a href="#_2-6-守护-daemon-线程" class="header-anchor">#</a> 2.6 守护(daemon)线程</h2> <ul><li>线程分为用户线程和守护线程</li> <li>JVM必须确保用户线程执行完毕  如main()函数</li> <li>JVM不用等待守护线程执行完毕</li> <li>例：后台记录操作日志，监控内存，垃圾回收......</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token class-name">Multics</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestDaemon</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">God</span> god <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">God</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">You</span> you <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">You</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>god<span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread<span class="token punctuation">.</span><span class="token function">setDaemon</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//默认为false</span>
        thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>you<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//上帝类</span>
<span class="token keyword">class</span> <span class="token class-name">God</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;上帝保佑着你&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//人类</span>
<span class="token keyword">class</span> <span class="token class-name">You</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">36500</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;你的一生都开心地活着&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========goodbye  world!=============&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/8ca4f159d8bf4c8ab97d5b9916939eb2.png?x-oss-process=image" loading="lazy" class="lazy"></p> <h1 id="_3-线程同步"><a href="#_3-线程同步" class="header-anchor">#</a> 3 线程同步</h1> <p>目的：多个线程操作同一个资源。如抢票系统</p> <p>主要思想：队列+锁(确保安全)。
处理多线程问题时，多个线程访问同一个对象，并且某些线程还想修改这个对象。这时候我们就需要线程同步，线程同步其实就是一种等待机制，多个需要同时访问次对象的线程进入这个对象的等待吃形成队列，等待前面线程是哟弄个完毕，下一个线程在使用。</p> <p>锁机制：为了保证数据在方法中被访问时的正确性，在访问时加入<code>锁机制：synchronized</code>。当一个线程获得对象的排他锁，就可以独占资源，其他线程必须等待，使用完后可以释放锁。</p> <ul><li>一个线程持有锁会导致其他所有需要此锁的线程挂起</li> <li>在多线程竞争下，加锁、释放锁会导致比较多的<u>上下文切换和调度延时</u>，导致性能问题</li> <li>如果一个优先级高的线程等待一个优先级低的线程释放锁，会导致优先级倒置，引起性能问题</li></ul> <h2 id="三大不安全案例"><a href="#三大不安全案例" class="header-anchor">#</a> 三大不安全案例</h2> <h3 id="_1-抢票系统"><a href="#_1-抢票系统" class="header-anchor">#</a> 1.抢票系统</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token class-name">Multics</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UnsafeBuyTicket</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">BuyTicket</span> buyTicket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BuyTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>buyTicket<span class="token punctuation">,</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>buyTicket<span class="token punctuation">,</span><span class="token string">&quot;李四&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>buyTicket<span class="token punctuation">,</span><span class="token string">&quot;黄牛&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">BuyTicket</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">{</span>
    <span class="token comment">//票</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> ticketNums<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> flag<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">buy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">buy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//判断是否有票</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ticketNums<span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            flag<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//模拟延时</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//买票</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;拿到了&quot;</span><span class="token operator">+</span>ticketNums<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/6d3237dc79ff4a32a36f77e81806c702.png?x-oss-process=image" loading="lazy" class="lazy"></p> <p>线程操作资源时没有上锁，导致线程不安全。</p> <h3 id="_2-银行取钱"><a href="#_2-银行取钱" class="header-anchor">#</a> 2.银行取钱</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token class-name">Multics</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UnsafeBank</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Account</span> account<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Account</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token string">&quot;基金&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Drawing</span> you<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Drawing</span><span class="token punctuation">(</span>account<span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token string">&quot;你&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Drawing</span> friend<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Drawing</span><span class="token punctuation">(</span>account<span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token string">&quot;friend&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        you<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        friend<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">//账户</span>
<span class="token keyword">class</span> <span class="token class-name">Account</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> money<span class="token punctuation">;</span>  <span class="token comment">//余额</span>
    <span class="token class-name">String</span> name<span class="token punctuation">;</span> <span class="token comment">//卡号</span>

    <span class="token keyword">public</span> <span class="token class-name">Account</span><span class="token punctuation">(</span><span class="token keyword">int</span> money<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>money <span class="token operator">=</span> money<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//银行  模拟取款</span>
<span class="token keyword">class</span> <span class="token class-name">Drawing</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span><span class="token punctuation">{</span>
    <span class="token class-name">Account</span> account<span class="token punctuation">;</span>
    <span class="token comment">//取了多少钱</span>
    <span class="token keyword">int</span> drawingMoney<span class="token punctuation">;</span>
    <span class="token comment">//现在手里由多少钱</span>
    <span class="token keyword">int</span> nowMoney<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Drawing</span><span class="token punctuation">(</span><span class="token class-name">Account</span> account<span class="token punctuation">,</span> <span class="token keyword">int</span> drawingMoney<span class="token punctuation">,</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>account <span class="token operator">=</span> account<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>drawingMoney <span class="token operator">=</span> drawingMoney<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//取钱</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//判断有没有钱</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>account<span class="token punctuation">.</span>money<span class="token operator">-</span>drawingMoney<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;余额不足&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//更新余额与现金</span>
        account<span class="token punctuation">.</span>money<span class="token operator">-=</span>drawingMoney<span class="token punctuation">;</span>
        nowMoney<span class="token operator">+=</span>drawingMoney<span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>account<span class="token punctuation">.</span>name<span class="token operator">+</span><span class="token string">&quot;余额为：&quot;</span><span class="token operator">+</span>account<span class="token punctuation">.</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;现金：&quot;</span><span class="token operator">+</span>nowMoney<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/c2864545c80345d1af4ddd1f759b4a82.png?x-oss-process=image" loading="lazy" class="lazy"></p> <h3 id="_3-线程安全"><a href="#_3-线程安全" class="header-anchor">#</a> 3.线程安全</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token class-name">Multics</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UnsafeList</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">10000</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
                list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/33be83adbf264fdcbaa6dfe6cd344049.png#pic_center" loading="lazy" class="lazy"></p> <h2 id="同步方法"><a href="#同步方法" class="header-anchor">#</a> 同步方法</h2> <p><code>synchronized</code>关键字</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</code></pre></div><p>synchronized修饰的方法必须先获得调用该方法对象的锁后才能执行，否则线程会阻塞。</p> <h3 id="_1-抢票系统-2"><a href="#_1-抢票系统-2" class="header-anchor">#</a> 1.抢票系统</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token class-name">Multics</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UnsafeBuyTicket</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">BuyTicket</span> buyTicket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BuyTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>buyTicket<span class="token punctuation">,</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>buyTicket<span class="token punctuation">,</span><span class="token string">&quot;李四&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>buyTicket<span class="token punctuation">,</span><span class="token string">&quot;黄牛&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">BuyTicket</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">{</span>
    <span class="token comment">//......</span>

    <span class="token comment">//对this加锁</span>
    <span class="token keyword">private</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">buy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//......</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/0e7fb8d1ce1f426caaad232850b77251.png#pic_center" loading="lazy" class="lazy"></p> <h3 id="_2-银行取钱-2"><a href="#_2-银行取钱-2" class="header-anchor">#</a> 2.银行取钱</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token class-name">Multics</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UnsafeBank</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Account</span> account<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Account</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token string">&quot;基金&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Drawing</span> you<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Drawing</span><span class="token punctuation">(</span>account<span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token string">&quot;你&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Drawing</span> friend<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Drawing</span><span class="token punctuation">(</span>account<span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token string">&quot;friend&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        you<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        friend<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">//账户</span>
<span class="token keyword">class</span> <span class="token class-name">Account</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

<span class="token comment">//银行  模拟取款</span>
<span class="token keyword">class</span> <span class="token class-name">Drawing</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span><span class="token punctuation">{</span>
    <span class="token comment">//......</span>
    
    <span class="token comment">//取钱</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//通过synchronized块对account上锁。默认上锁this</span>
        <span class="token keyword">synchronized</span><span class="token punctuation">(</span>account<span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token comment">//源码套上synchronized块</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/d9719351adaa4fccbcf35efbf05ee113.png#pic_center" loading="lazy" class="lazy"></p> <h3 id="_3-线程安全-2"><a href="#_3-线程安全-2" class="header-anchor">#</a> 3.线程安全</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token class-name">Multics</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UnsafeList</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">10000</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/e1ae6e14a6df47b390f6532769914459.png#pic_center" loading="lazy" class="lazy"></p> <p>也可以使用现成的JUC安全类型集合</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token class-name">Multics</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CopyOnWriteArrayList</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestJUC</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">CopyOnWriteArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">CopyOnWriteArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">10000</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
                list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h1 id="_4-锁"><a href="#_4-锁" class="header-anchor">#</a> 4.锁</h1> <h2 id="_4-1-死锁"><a href="#_4-1-死锁" class="header-anchor">#</a> 4.1 死锁</h2> <p>产生死锁的四个必要条件：</p> <ol><li>互斥条件：一个资源每次只能被一个进程使用。</li> <li>请求余保持条件：一个进程因请求资源而阻塞时，对已获得的资源保持不放。</li> <li>不剥夺条件：进程已获得的资源，在未使用完之前，不能强行剥夺。</li> <li>循环等待条件：若干进程之间形成一种头尾相接的循环等待资源关系</li></ol> <p>化妆案例</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token class-name">Multics</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeadDock</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Makeup</span> g1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Makeup</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Makeup</span> g2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Makeup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        g1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        g2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//口红</span>
<span class="token keyword">class</span> <span class="token class-name">Lipstick</span><span class="token punctuation">{</span> <span class="token punctuation">}</span>
<span class="token comment">//镜子</span>
<span class="token keyword">class</span> <span class="token class-name">Mirror</span><span class="token punctuation">{</span> <span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Makeup</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span><span class="token punctuation">{</span>
    <span class="token comment">//需要的资源都只有一份</span>
    <span class="token keyword">static</span> <span class="token class-name">Lipstick</span> lipstick<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Lipstick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token class-name">Mirror</span> mirror<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Mirror</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> choice<span class="token punctuation">;</span>
    <span class="token class-name">String</span> girlName<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Makeup</span><span class="token punctuation">(</span><span class="token keyword">int</span> choice<span class="token punctuation">,</span> <span class="token class-name">String</span> girlName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>choice <span class="token operator">=</span> choice<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>girlName <span class="token operator">=</span> girlName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">makeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//化妆</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//化妆，一个人有口红，另一个人有镜子。双方都需要对方的资源</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">makeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>choice <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lipstick<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//获得口红的锁</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>girlName <span class="token operator">+</span> <span class="token string">&quot;获得了口红的锁&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token comment">//1s后，想获得镜子的锁</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>mirror<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//获得镜子的锁</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>girlName <span class="token operator">+</span> <span class="token string">&quot;获得了镜子的锁&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>mirror<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//获得镜子的锁</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>girlName <span class="token operator">+</span> <span class="token string">&quot;获得了镜子的锁&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token comment">//1s后，想获得口红的锁</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lipstick<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//获得口红的锁</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>girlName <span class="token operator">+</span> <span class="token string">&quot;获得了口红的锁&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/116808f2d4a84fba9b6c7cd6e970d2d8.png?x-oss-process=image" loading="lazy" class="lazy"></p> <p>修改代码</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token class-name">Multics</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeadDock</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Makeup</span> g1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Makeup</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Makeup</span> g2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Makeup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        g1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        g2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//口红</span>
<span class="token keyword">class</span> <span class="token class-name">Lipstick</span><span class="token punctuation">{</span> <span class="token punctuation">}</span>
<span class="token comment">//镜子</span>
<span class="token keyword">class</span> <span class="token class-name">Mirror</span><span class="token punctuation">{</span> <span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Makeup</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span><span class="token punctuation">{</span>
    <span class="token comment">//......</span>
    <span class="token comment">//化妆，一个人有口红，另一个人有镜子。双方都需要对方的资源</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">makeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>choice <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lipstick<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//获得口红的锁</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>girlName <span class="token operator">+</span> <span class="token string">&quot;获得了口红的锁&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            
            <span class="token comment">//1s后，想获得镜子的锁</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>mirror<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//获得镜子的锁</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>girlName <span class="token operator">+</span> <span class="token string">&quot;获得了镜子的锁&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>mirror<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//获得镜子的锁</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>girlName <span class="token operator">+</span> <span class="token string">&quot;获得了镜子的锁&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            
            <span class="token comment">//1s后，想获得口红的锁</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lipstick<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//获得口红的锁</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>girlName <span class="token operator">+</span> <span class="token string">&quot;获得了口红的锁&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/fc0e9ae6b3d0487d83aa3a375e43aee4.png?x-oss-process=image" loading="lazy" class="lazy"></p> <h2 id="_4-2-lock锁-jdk"><a href="#_4-2-lock锁-jdk" class="header-anchor">#</a> 4.2 Lock锁(JDK)</h2> <p>java.util.concurrent.locks.Lock接口时控制多个线程对共享资源进行访问的工具。锁提供了对共享资源的独占访问，每次只能有一个线程对Lock对象枷锁，线程开始访问共享资源之前应先获得的Lock对象。</p> <p>ReentrantLock类(可重入锁)实现了Lock，它拥有与synchronized相同的并发性和内存语义，在实现线程安全的控制中，比较常用的是ReentrantLock，可以显示加锁、释放锁。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token class-name">Multics</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">ReentrantLock</span><span class="token punctuation">;</span>

<span class="token comment">//抢票模拟</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestLock</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">TestLock2</span> testLock2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TestLock2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>testLock2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>testLock2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>testLock2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">TestLock2</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">{</span>

    <span class="token keyword">int</span> ticketNums<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>

    <span class="token comment">//定义lock锁。默认对this上锁</span>
    <span class="token keyword">private</span>  <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//显式加锁</span>

                <span class="token keyword">if</span><span class="token punctuation">(</span>ticketNums<span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ticketNums<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//显式解锁</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/32ea06e8b11f4800b1398fbb06043e33.png?x-oss-process=image" loading="lazy" class="lazy"></p> <p><code>sychronized</code> 和<code>Lock</code>对比：</p> <ul><li>Lock式显式锁。sychronized是隐式锁。后者加锁、释放锁自动完成。</li> <li>Lock只有代码块锁。sychronized有代码块所和方法锁。</li> <li>使用Lock锁，JVM将花费较少的时间来调度线程，性能更好。并且具有更好的扩展性(提供更多的子类)</li> <li>优先使用顺序：Lock&gt;同步代码块&gt;同步方法</li></ul> <h1 id="_5-线程通信"><a href="#_5-线程通信" class="header-anchor">#</a> 5.线程通信</h1> <h2 id="生产者、消费者问题"><a href="#生产者、消费者问题" class="header-anchor">#</a> 生产者、消费者问题</h2> <p>前提：</p> <ul><li>假设仓库中只能存放一件产品，生产者将生产出来的产品放入仓库，消费者将仓库中的产品取走消费。</li> <li>如果仓库中没有产品，则生产者将产品放入仓库，否则停止生产并等待，知道仓库中的产品被消费者取走为止。</li> <li>如果仓库中放有产品，则消费者可以将产品取走消费，否则停止消费并等待，知道仓库中再次放入产品为止。</li></ul> <p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/fbfa55df92d34c8a94cac65e3ea7c450.png?x-oss-process=image" loading="lazy" class="lazy"></p> <p>该问题中，生产者和消费者之间相互依赖，互为条件：</p> <ol><li></li></ol> <ul><li>对于生产者，没有生产产品之前，要通知消费者等待。生产了产品之后，有需要马上通知消费者消费。</li> <li>对于消费者，在消费之后，要通知生产者已经结束消费，需要生产新的产品以供消费。</li> <li>该问题中，只用<code>synchronized</code>是不够的。1.<code>synchronized</code>可以组织并发更新同一个共享资源，实现了同步。 2.<code>synchronized</code>不能用来实现不同线程之间的消息传递(通信)</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//线程通信相关的java方法</span>
<span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//表示线程已知等待，知道其他线程通知，与sleep不同，会释放锁</span>
<span class="token function">wait</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeout<span class="token punctuation">)</span>  <span class="token comment">//指定等待的毫秒数</span>
<span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//唤醒一个处于等待状态的线程</span>
<span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//唤醒同一个对象上所有调用wait()方法的线程，优先级高的线程优先</span>
</code></pre></div><p>注：以上均为Object类的方法，都只能在同步方法或同步代码块中使用，否则会抛出异常<code>IllegalMonitorStateException</code></p> <h2 id="解决方式"><a href="#解决方式" class="header-anchor">#</a> 解决方式</h2> <h3 id="_1-管程法"><a href="#_1-管程法" class="header-anchor">#</a> 1.管程法</h3> <ul><li>生产者：负责生产数据的模块(可能是方法，对象，线程，进程)；</li> <li>消费者：负责处理数据的模块(可能是方法，对象，线程，进程)；</li> <li>缓冲区：消费者不能直接使用生产者的数据。他们之间有一个缓冲区；</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token class-name">Multics</span><span class="token punctuation">;</span>

<span class="token comment">//需要的类：生产者、消费者、产品、缓冲区</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestPC</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SynContainer</span> container<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">SynContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Productor</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Consumer</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">//生产者</span>
<span class="token keyword">class</span> <span class="token class-name">Productor</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span><span class="token punctuation">{</span>
    <span class="token class-name">SynContainer</span> container<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Productor</span><span class="token punctuation">(</span><span class="token class-name">SynContainer</span> container<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>container<span class="token operator">=</span>container<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//生产</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">100</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            container<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Chicken</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;生产了&quot;</span><span class="token operator">+</span>i<span class="token operator">+</span><span class="token string">&quot;只鸡&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//消费者</span>
<span class="token keyword">class</span> <span class="token class-name">Consumer</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span><span class="token punctuation">{</span>
    <span class="token class-name">SynContainer</span> container<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Consumer</span><span class="token punctuation">(</span><span class="token class-name">SynContainer</span> container<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>container<span class="token operator">=</span>container<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//消费</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;消费了--&gt;&quot;</span><span class="token operator">+</span>container<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>id<span class="token operator">+</span><span class="token string">&quot;只鸡&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//产品</span>
<span class="token keyword">class</span> <span class="token class-name">Chicken</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> id<span class="token punctuation">;</span> <span class="token comment">//产品编号</span>

    <span class="token keyword">public</span> <span class="token class-name">Chicken</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//缓冲区</span>
<span class="token keyword">class</span> <span class="token class-name">SynContainer</span><span class="token punctuation">{</span>

    <span class="token comment">//仓库大小</span>
    <span class="token class-name">Chicken</span><span class="token punctuation">[</span><span class="token punctuation">]</span> chickens<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Chicken</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">//当前容器已用大小</span>
    <span class="token keyword">int</span> count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">//生产者放入产品</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token class-name">Chicken</span> chicken<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//如果容器满了，就需要等待消费者消费</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>count<span class="token operator">==</span>chickens<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//通知消费者消费，生产者等待</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//如果容器没有满，则放入产品</span>
        chickens<span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token operator">=</span>chicken<span class="token punctuation">;</span>
        count<span class="token operator">++</span><span class="token punctuation">;</span>

        <span class="token comment">//通知消费者消费</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">//消费者取出产品</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">Chicken</span> <span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//判断能否消费</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>count<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//等待生产者生产，消费者等待</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//可以消费</span>
        count<span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token class-name">Chicken</span> chicken<span class="token operator">=</span>chickens<span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">//通知生产者生产</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> chicken<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/58b35963a65943b79d273a51a71ddc24.png?x-oss-process=image" loading="lazy" class="lazy"></p> <h3 id="_2-信号灯法"><a href="#_2-信号灯法" class="header-anchor">#</a> 2.信号灯法</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token class-name">Multics</span><span class="token punctuation">;</span>

<span class="token comment">//需要的类：生产者、消费者、产品、缓冲区</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestPC</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">TV</span> tv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">TV</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Player</span><span class="token punctuation">(</span>tv<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span>tv<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">//生产者--&gt;演员</span>
<span class="token keyword">class</span> <span class="token class-name">Player</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span><span class="token punctuation">{</span>
    <span class="token class-name">TV</span> tv<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Player</span><span class="token punctuation">(</span><span class="token class-name">TV</span> tv<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>tv <span class="token operator">=</span> tv<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">20</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">%</span><span class="token number">2</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>tv<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token string">&quot;节目A播放中&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>tv<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token string">&quot;节目B播放中&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//消费者--&gt;观众</span>
<span class="token keyword">class</span> <span class="token class-name">Watcher</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span><span class="token punctuation">{</span>
    <span class="token class-name">TV</span> tv<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span><span class="token class-name">TV</span> tv<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>tv <span class="token operator">=</span> tv<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">20</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            tv<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//产品--&gt;节目</span>
<span class="token keyword">class</span> TV<span class="token punctuation">{</span>
    <span class="token comment">//演员表演，观众等待 T</span>
    <span class="token comment">//观众观看，演员等待 F</span>
    <span class="token class-name">String</span> voice<span class="token punctuation">;</span> <span class="token comment">//节目</span>
    <span class="token keyword">boolean</span> flag<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment">//标志位</span>

    <span class="token comment">//表演</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">play</span><span class="token punctuation">(</span><span class="token class-name">String</span> voice<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>flag<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;演员表演了：&quot;</span><span class="token operator">+</span>voice<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//通知观众观看</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>voice<span class="token operator">=</span>voice<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>flag<span class="token operator">=</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>flag<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//观看</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;观看了：&quot;</span><span class="token operator">+</span>voice<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//通知演员表演</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>flag<span class="token operator">=</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>flag<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/f6a2772fde1e42ec8756b7058f3b7330.png?x-oss-process=image" loading="lazy" class="lazy"></p> <h1 id="_6-线程池"><a href="#_6-线程池" class="header-anchor">#</a> 6.线程池</h1> <p>背景：经常创建和销毁、使用特别大的资源，比如并发情况下的线程，对性能影响很大。</p> <p>思路：提前创建多个线程，放入线程池中，使用时直接获取，食用含放回池中。这样可以避免频繁创建销毁、实现重复利用。如显示生活中的公交车。</p> <p>优点：</p> <ul><li>提高相应速度(减少了创建新线程的时间)</li> <li>降低资源消耗(重复利用线程池中的线程，不需要每次都创建)</li> <li>便于线程管理（核心池大小、最大线程数、线程没有任务时最多保持多长时间后会终止......）</li></ul> <p>JDK5.0起提供了线程池相关API：<code>ExecutorService</code>和<code>Executors</code></p> <p>ExecutorService:真正的线程池接口。常见子类ThreadPoolExecutor</p> <ul><li><code>void execute(Runnable command)</code>:执行任务/命令，没有返回值，一般用来执行Runnable</li> <li><code>&lt;T&gt;Future&lt;T&gt;submmit(Callable&lt;T&gt;task)</code>:执行任务，有返回值，一般用来执行Callable</li> <li><code>void shutdown()</code>：关闭线程池</li></ul> <p>Executors：工具类、线程池的工具类，用于创建并返回不同类型的线程池。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token class-name">Multics</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Executor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutorService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Executors</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestPool</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//1.创建服务，创建线程池</span>
        <span class="token comment">//参数为线程池大小</span>
        <span class="token class-name">ExecutorService</span> service<span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//执行</span>
        service<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        service<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        service<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        service<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//2.关闭连接</span>
        service<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/5fded5f57c9443b59b4c58dae67076d2.png?x-oss-process=image" loading="lazy" class="lazy"></p></div> <div class="tail" data-v-3caaac61><div class="ending" data-v-3caaac61><span data-v-3caaac61>The post above ended</span> <i class="far fa-dot-circle fa-fw" data-v-3caaac61></i> <span data-v-3caaac61>Thanks for your reading</span></div> <div class="friend" data-v-3caaac61><div data-v-3caaac61>Come on! Write some comments, and your suggestions will improve the quality of my creative!</div> <div class="button" data-v-3caaac61>FRIEND ME</div> <div class="qrcode" data-v-3caaac61><div data-v-3caaac61><img src="/assets/img/qq.png" data-v-3caaac61> <div data-v-3caaac61>QQ</div></div><div data-v-3caaac61><img src="/assets/img/wechat.png" data-v-3caaac61> <div data-v-3caaac61>WeChat</div></div></div></div> <div class="share" data-v-3caaac61><!----></div> <div class="license" data-v-3caaac61><div class="frame" data-v-3caaac61><div data-v-3caaac61><span data-v-3caaac61>Post Author:</span> <a target="_blank" href="/" data-v-3caaac61>Mitchell</a></div> <div data-v-3caaac61><span data-v-3caaac61>Post Link:</span> <a target="_blank" href="/" data-v-3caaac61>/</a></div> <div data-v-3caaac61><span data-v-3caaac61>Copyright Notice:</span> <span data-v-3caaac61>All articles/posts in this website are licensed under <a target="_blank" href="//creativecommons.org/licenses/by-nc-sa/4.0/"><i class="fab fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally.</span></div></div></div> <div class="tags" data-v-3caaac61><a href="/tag/JavaSE/" data-v-3caaac61># JavaSE</a></div> <div class="pn" data-v-3caaac61><!----> <a href="/post/3180bd683d83c88ac5087709d51baf7b/#" title="Newer Post: undefined" class="next" data-v-3caaac61></a></div></div> <div class="readmode" data-v-3caaac61><span data-v-3caaac61>Enable Read Mode</span> <i class="fas fa-book-open" data-v-3caaac61></i></div></div></div> <div class="Comment card" data-v-0b506543 data-v-55aed3a6><div class="caption" data-v-0b506543><span class="icon" data-v-0b506543><i class="fas fa-comments fa-fw" data-v-0b506543></i></span> <span data-v-0b506543>COMMENTS</span></div> <div class="inner" data-v-0b506543><!----></div> <div class="minimize" data-v-0b506543></div></div></div></div> <div class="Empty card" style="background-image:url('/assets/img/empty.png');" data-v-22aaa453 data-v-5f6ffb84></div></div> <div class="aside" data-v-5f6ffb84><div class="Aside" data-v-07032a5d data-v-5f6ffb84><div class="Panel" data-v-70581521 data-v-07032a5d><div class="card" data-v-70581521><div class="caption" data-v-70581521><span class="icon" data-v-70581521><i class="fas fa-folder-open fa-fw"></i></span> <span data-v-70581521>CATEGORIES</span></div> <div class="inner" data-v-70581521><a href="/category/语言/" style="font-size:1.1166666666666667rem;opacity:1;" data-v-70581521>语言</a><a href="/category/Blog/" style="font-size:0.9166666666666666rem;opacity:0.7272727272727273;" data-v-70581521>Blog</a><a href="/category/网络/" style="font-size:0.7833333333333333rem;opacity:0.5454545454545454;" data-v-70581521>网络</a><a href="/category/Note/" style="font-size:0.7833333333333333rem;opacity:0.5454545454545454;" data-v-70581521>Note</a><a href="/category/前端/" style="font-size:0.7833333333333333rem;opacity:0.5454545454545454;" data-v-70581521>前端</a><a href="/category/web开发/" style="font-size:0.8166666666666667rem;opacity:0.5909090909090909;" data-v-70581521>web开发</a><a href="/category/数据库/" style="font-size:0.8166666666666667rem;opacity:0.5909090909090909;" data-v-70581521>数据库</a><a href="/category/java框架/" style="font-size:0.7833333333333333rem;opacity:0.5454545454545454;" data-v-70581521>java框架</a><a href="/category/其他/" style="font-size:0.8166666666666667rem;opacity:0.5909090909090909;" data-v-70581521>其他</a><a href="/category/算法/" style="font-size:0.7833333333333333rem;opacity:0.5454545454545454;" data-v-70581521>算法</a><a href="/category/后端框架/" style="font-size:0.8166666666666667rem;opacity:0.5909090909090909;" data-v-70581521>后端框架</a><a href="/category/Spring/" style="font-size:0.8166666666666667rem;opacity:0.5909090909090909;" data-v-70581521>Spring</a><a href="/category/操作系统/" style="font-size:0.7833333333333333rem;opacity:0.5454545454545454;" data-v-70581521>操作系统</a><a href="/category/Plugin/" style="font-size:0.8166666666666667rem;opacity:0.5909090909090909;" data-v-70581521>Plugin</a><a href="/category/Hexo/" style="font-size:0.7833333333333333rem;opacity:0.5454545454545454;" data-v-70581521>Hexo</a></div> <!----> <div class="minimize" data-v-70581521></div></div><div class="card" data-v-70581521><div class="caption" data-v-70581521><span class="icon" data-v-70581521><i class="fas fa-tags fa-fw"></i></span> <span data-v-70581521>TAGS</span></div> <!----> <div class="inner" data-v-70581521><a href="/tag/2048/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>2048</a><a href="/tag/JavaSE/" style="font-size:1.0833333333333333rem;opacity:1;" data-v-70581521>JavaSE</a><a href="/tag/Test/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>Test</a><a href="/tag/HTTP/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>HTTP</a><a href="/tag/HTTPS/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>HTTPS</a><a href="/tag/Links/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>Links</a><a href="/tag/JavaScript/" style="font-size:0.85rem;opacity:0.65;" data-v-70581521>JavaScript</a><a href="/tag/JavaWeb/" style="font-size:0.8166666666666667rem;opacity:0.6;" data-v-70581521>JavaWeb</a><a href="/tag/JavaEE/" style="font-size:0.85rem;opacity:0.65;" data-v-70581521>JavaEE</a><a href="/tag/XML/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>XML</a><a href="/tag/vuepressBlog/" style="font-size:0.8166666666666667rem;opacity:0.6;" data-v-70581521>vuepressBlog</a><a href="/tag/娱乐/" style="font-size:0.8166666666666667rem;opacity:0.6;" data-v-70581521>娱乐</a><a href="/tag/高中回忆/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>高中回忆</a><a href="/tag/algorithm/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>algorithm</a><a href="/tag/操作系统/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>操作系统</a><a href="/tag/command/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>command</a><a href="/tag/数据库/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>数据库</a><a href="/tag/SQL/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>SQL</a><a href="/tag/C/C++/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>C/C++</a><a href="/tag/音乐播放器/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>音乐播放器</a><a href="/tag/old blog/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>old blog</a><a href="/tag/diary/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>diary</a></div> <div class="minimize" data-v-70581521></div></div></div> <div class="Audioplayer card" data-v-18c8023d data-v-07032a5d><div class="caption" data-v-18c8023d><span class="icon" data-v-18c8023d><i class="fas fa-music fa-fw" data-v-18c8023d></i></span> <span data-v-18c8023d>PLAYLIST</span></div> <div class="inner" style="height:calc(297px + 90px);" data-v-18c8023d><meting-js server="netease"type="playlist"id="7256148570"theme="var(--link)"list-max-height="297px"></meting-js></div> <div class="minimize" data-v-18c8023d></div></div> <!----> <div class="Toc card" data-v-022f25d3 data-v-07032a5d data-v-07032a5d><div class="caption" data-v-022f25d3><span class="icon" data-v-022f25d3><i class="fas fa-bookmark fa-fw" data-v-022f25d3></i></span> <span data-v-022f25d3>TABLE OF CONTENTS</span></div> <div class="inner" data-v-022f25d3><div data-v-022f25d3><ul><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#java多线程">Java多线程</a></li><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#_1-线程创建">1.线程创建</a><ul><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#_1-1-创建thread">1.1 创建Thread</a></li><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#_1-2-多线程网图下载">1.2 多线程网图下载</a></li><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#_1-3-实现runnable接口">1.3 实现Runnable接口</a></li><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#_1-4-实现callable接口-次要">1.4 实现Callable接口（次要）</a></li><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#例子-购买火车票">例子：购买火车票</a></li><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#例子-龟兔赛跑">例子：龟兔赛跑</a></li><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#_1-5-静态代理模式">1.5 静态代理模式</a></li><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#lambda表达式">Lambda表达式</a></li></ul></li><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#_2-线程操作">2.线程操作</a><ul><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#_2-0-java线程基本内容">2.0 Java线程基本内容</a></li><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#_2-1-线程停止">2.1 线程停止</a></li><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#_2-2-线程休眠">2.2 线程休眠</a></li><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#_2-3-线程礼让">2.3 线程礼让</a></li><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#_2-4-线程强制执行">2.4 线程强制执行</a></li><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#_2-5-线程优先级">2.5 线程优先级</a></li><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#_2-6-守护-daemon-线程">2.6 守护(daemon)线程</a></li></ul></li><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#_3-线程同步">3 线程同步</a><ul><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#三大不安全案例">三大不安全案例</a><ul><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#_1-抢票系统">1.抢票系统</a></li><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#_2-银行取钱">2.银行取钱</a></li><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#_3-线程安全">3.线程安全</a></li></ul></li><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#同步方法">同步方法</a><ul><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#_1-抢票系统-2">1.抢票系统</a></li><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#_2-银行取钱-2">2.银行取钱</a></li><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#_3-线程安全-2">3.线程安全</a></li></ul></li></ul></li><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#_4-锁">4.锁</a><ul><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#_4-1-死锁">4.1 死锁</a></li><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#_4-2-lock锁-jdk">4.2 Lock锁(JDK)</a></li></ul></li><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#_5-线程通信">5.线程通信</a><ul><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#生产者、消费者问题">生产者、消费者问题</a></li><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#解决方式">解决方式</a><ul><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#_1-管程法">1.管程法</a></li><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#_2-信号灯法">2.信号灯法</a></li></ul></li></ul></li><li><a href="/post/3180bd683d83c88ac5087709d51baf7b/#_6-线程池">6.线程池</a></li></ul></div></div></div></div></div> <div class="footer" data-v-5f6ffb84><div data-v-5f6ffb84><div class="Footer" data-v-1e7563d3 data-v-5f6ffb84><div data-v-1e7563d3>© 2019 - 2022 Mitchell</div> <div data-v-1e7563d3></div> <div data-v-1e7563d3>Theme <a target="_blank" href="//github.com/jinyaoMa/vuepress-theme-mustom" title="vuepress-theme-mustom">Mustom</a> By <a target="_blank" href="//github.com/jinyaoMa" title="jinyaoMa">jinyaoMa</a></div> <div class="footerCount" data-v-1e7563d3><span title="Site total page views" data-v-1e7563d3><i class="fas fa-eye fa-fw" data-v-1e7563d3></i>
      ∞
    </span> <span title="Site total visitors" data-v-1e7563d3><i class="fas fa-user-tie fa-fw" data-v-1e7563d3></i>
      ∞
    </span> <span title="Site total word count" data-v-1e7563d3><i class="fas fa-file-word fa-fw" data-v-1e7563d3></i>
      130.2k
    </span></div> <div class="license" data-v-1e7563d3><a class="by-nc-sa" target="_blank" href="//creativecommons.org/licenses/by-nc-sa/4.0/" title="Creative Commons Attribution-Noncommercial-ShareAlike 4.0 International license"></a></div></div></div></div></div></div> <div class="Notification default hide" data-v-1c9c144c data-v-5f6ffb84><div class="frame" data-v-1c9c144c><div class="inner" data-v-1c9c144c><div class="icon" data-v-1c9c144c><i class="fas fa-exclamation-circle fa-fw"></i></div> <div class="msg" data-v-1c9c144c>DEFAULT</div></div></div></div></div><div class="global-ui"><!----><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;right:48px;bottom:0px;width:180px;height:270px;z-index:99999;opacity:1;pointer-events:none;"><canvas id="live2d_canvas" width="180" height="270" class="live2d_canvas" style="position:absolute;left:0px;top:0px;width:180px;height:270px;"></canvas></div></div></div>
    <script src="./assets/js/app.152d2abe.js" defer></script><script src="./assets/js/5.45f84343.js" defer></script><script src="./assets/js/24.cd8025ea.js" defer></script><script src="./assets/js/10.e02dcdbc.js" defer></script><script src="./assets/js/7.6b3198e2.js" defer></script>
  </body>
</html>
