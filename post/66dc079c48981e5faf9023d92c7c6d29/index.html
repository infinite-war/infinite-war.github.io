<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaWeb(二) | infinite-war の BLOG</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/assets/img/apple-touch-icon.png">
    <meta name="description" content="# JavaWeb（二）学习视频：BV12J411M7Sjhttps://blog.csdn.net/INFINITE_WAR/article/details/123670628@[toc]# 8、JSP`Java Server Pages`: Java服务端页面，和Servlet一样，用于 ...">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#ffffff">
    <meta name="google-site-verification" content="DR-3xvCA7YBP7TIeg7__j5lxaniGh2pzocrfywyn8o0">
    <meta name="baidu-site-verification" content="zQef3H7nga">
    
    <link rel="preload" href="./assets/css/0.styles.ab82154a.css" as="style"><link rel="preload" href="./assets/js/app.152d2abe.js" as="script"><link rel="preload" href="./assets/js/5.45f84343.js" as="script"><link rel="preload" href="./assets/js/23.1c3c301b.js" as="script"><link rel="preload" href="./assets/js/10.e02dcdbc.js" as="script"><link rel="preload" href="./assets/js/7.6b3198e2.js" as="script"><link rel="prefetch" href="./assets/js/11.56ca4439.js"><link rel="prefetch" href="./assets/js/12.e7263128.js"><link rel="prefetch" href="./assets/js/13.6aa36547.js"><link rel="prefetch" href="./assets/js/14.17d1cb9e.js"><link rel="prefetch" href="./assets/js/15.74bd3f85.js"><link rel="prefetch" href="./assets/js/16.6cb58eaa.js"><link rel="prefetch" href="./assets/js/17.a2418203.js"><link rel="prefetch" href="./assets/js/18.0ce3e861.js"><link rel="prefetch" href="./assets/js/19.d38b8843.js"><link rel="prefetch" href="./assets/js/20.c056825b.js"><link rel="prefetch" href="./assets/js/21.55f4c10c.js"><link rel="prefetch" href="./assets/js/22.04dd41d1.js"><link rel="prefetch" href="./assets/js/24.cd8025ea.js"><link rel="prefetch" href="./assets/js/25.ba1b9f93.js"><link rel="prefetch" href="./assets/js/26.6682378c.js"><link rel="prefetch" href="./assets/js/27.b37436f6.js"><link rel="prefetch" href="./assets/js/28.a5979a1e.js"><link rel="prefetch" href="./assets/js/29.b5265440.js"><link rel="prefetch" href="./assets/js/3.9a5ec62e.js"><link rel="prefetch" href="./assets/js/30.3e2cac84.js"><link rel="prefetch" href="./assets/js/31.6c7014c4.js"><link rel="prefetch" href="./assets/js/32.3f06e55b.js"><link rel="prefetch" href="./assets/js/33.b1d68207.js"><link rel="prefetch" href="./assets/js/34.76d77190.js"><link rel="prefetch" href="./assets/js/35.4683a28e.js"><link rel="prefetch" href="./assets/js/36.9cf1d52f.js"><link rel="prefetch" href="./assets/js/37.3f6975cf.js"><link rel="prefetch" href="./assets/js/38.f88fc48d.js"><link rel="prefetch" href="./assets/js/39.f219d981.js"><link rel="prefetch" href="./assets/js/4.dfb684c6.js"><link rel="prefetch" href="./assets/js/40.ff3307ef.js"><link rel="prefetch" href="./assets/js/41.50e1e4a2.js"><link rel="prefetch" href="./assets/js/42.375a133d.js"><link rel="prefetch" href="./assets/js/43.a125d1e0.js"><link rel="prefetch" href="./assets/js/44.54249944.js"><link rel="prefetch" href="./assets/js/45.17c8ad02.js"><link rel="prefetch" href="./assets/js/46.1e1ff28c.js"><link rel="prefetch" href="./assets/js/47.805830d4.js"><link rel="prefetch" href="./assets/js/48.edec476d.js"><link rel="prefetch" href="./assets/js/49.44e0d779.js"><link rel="prefetch" href="./assets/js/50.f607e4f6.js"><link rel="prefetch" href="./assets/js/6.a2b9c671.js"><link rel="prefetch" href="./assets/js/8.0d136561.js"><link rel="prefetch" href="./assets/js/9.11f39998.js"><link rel="prefetch" href="./assets/js/vuejs-paginate.b3baa744.js">
    <link rel="stylesheet" href="./assets/css/0.styles.ab82154a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="GlobalLayout skin-jshine" data-v-5f6ffb84><!----> <div class="Launch" data-v-2d5332d6 data-v-5f6ffb84><div class="avatar" style="background-image:url('/assets/img/avatar.png');" data-v-2d5332d6></div></div> <div class="Spinner " data-v-4a1f0306 data-v-5f6ffb84></div> <div class="Header" data-v-a012f084 data-v-5f6ffb84><div class="ext " data-v-a012f084><i class="fas fa-cube" data-v-a012f084></i></div> <div class="sitename" data-v-a012f084><em><span>infinite-war's</span></em><strong><span>BLOG</span></strong></div> <div class="ext " data-v-a012f084><i class="fas fa-search" data-v-a012f084></i></div></div> <div class="Goingto" data-v-106a8802 data-v-5f6ffb84><div class="top" data-v-106a8802><i class="fas fa-arrow-up" data-v-106a8802></i></div> <div class="bottom" data-v-106a8802><i class="fas fa-arrow-down" data-v-106a8802></i></div></div> <div class="Addin" data-v-68b01994 data-v-5f6ffb84><div class="top " data-v-68b01994><i class="fas fa-ad" data-v-68b01994></i></div> <div class="bottom " data-v-68b01994><i class="fas fa-qrcode" data-v-68b01994></i></div> <!----></div> <!----> <div class="frame" data-v-5f6ffb84><div class="main" data-v-5f6ffb84><div class="drawer" data-v-5f6ffb84><div class="Drawer" data-v-68407f5a data-v-5f6ffb84><div class="Brand card" data-v-bb741bc0 data-v-68407f5a><div class="caption ifSmallest" data-v-bb741bc0><span class="icon" data-v-bb741bc0><i class="fas fa-id-card fa-fw" data-v-bb741bc0></i></span> <span data-v-bb741bc0>CARD</span></div> <div class="avatar" style="background-image:url('/assets/img/brand.png');" data-v-bb741bc0></div> <div class="inner" data-v-bb741bc0><div class="author" data-v-bb741bc0>Mitchell</div> <div class="signature" data-v-bb741bc0>issue, func, flow, std, solve</div> <div class="counter" data-v-bb741bc0><span title="Count of Posts" data-v-bb741bc0><i class="fas fa-archive fa-fw" data-v-bb741bc0></i>
        30 </span>|
      <span title="Count of Categories" data-v-bb741bc0><i class="fas fa-folder-open fa-fw" data-v-bb741bc0></i>
        15 </span>|
      <span title="Count of Tags" data-v-bb741bc0><i class="fas fa-tags fa-fw" data-v-bb741bc0></i>
        22
      </span></div> <div class="contact" data-v-bb741bc0><a target="_blank" href="https://github.com/infinite-war" title="infinite-war" data-v-bb741bc0><i class="fab fa-github fa-fw"></i></a><a target="_blank" href="mailto://969557028@qq.com" title="969557028@qq.com" data-v-bb741bc0><i class="fas fa-envelope fa-fw"></i></a><a target="_blank" href="tencent://Message/?uin=969557028" title="969557028" data-v-bb741bc0><i class="fab fa-qq fa-fw"></i></a></div></div> <div class="minimize ifSmallest" data-v-bb741bc0></div></div> <div class="Menu" data-v-098eaa92 data-v-68407f5a><div class="card" data-v-098eaa92><div class="caption" data-v-098eaa92><span class="icon" data-v-098eaa92><i class="fas fa-sitemap fa-fw"></i></span> <span data-v-098eaa92>MENU</span></div> <div class="inner" data-v-098eaa92><a href="/" class="router-link-active" data-v-098eaa92><span class="icon" data-v-098eaa92><i class="fas fa-home fa-fw"></i></span> <span data-v-098eaa92>Home</span></a><a href="/archive/" data-v-098eaa92><span class="icon" data-v-098eaa92><i class="fas fa-archive fa-fw"></i></span> <span data-v-098eaa92>Archive</span></a><a href="/codes/" data-v-098eaa92><span class="icon" data-v-098eaa92><i class="fas fa-box fa-fw"></i></span> <span data-v-098eaa92>Code Library</span></a><a href="/icons/" data-v-098eaa92><span class="icon" data-v-098eaa92><i class="fas fa-icons fa-fw"></i></span> <span data-v-098eaa92>Icon Font Library</span></a><a href="/records/" data-v-098eaa92><span class="icon" data-v-098eaa92><i class="fas fa-edit fa-fw"></i></span> <span data-v-098eaa92>Records</span></a><a href="/gallery/" data-v-098eaa92><span class="icon" data-v-098eaa92><i class="fas fa-images fa-fw"></i></span> <span data-v-098eaa92>Gallery</span></a><a href="/resume/" data-v-098eaa92><span class="icon" data-v-098eaa92><i class="fas fa-paper-plane fa-fw"></i></span> <span data-v-098eaa92>Resume Tips</span></a><a href="/letter/" data-v-098eaa92><span class="icon" data-v-098eaa92><i class="fas fa-file-contract fa-fw"></i></span> <span data-v-098eaa92>Cover Letter Tips</span></a><a href="/about/" data-v-098eaa92><span class="icon" data-v-098eaa92><i class="fas fa-user fa-fw"></i></span> <span data-v-098eaa92>About</span></a></div> <div class="minimize" data-v-098eaa92></div></div></div> <div class="Skin card" data-v-5752a7b7 data-v-68407f5a><div class="caption" data-v-5752a7b7><span class="icon" data-v-5752a7b7><i class="fas fa-tshirt fa-fw" data-v-5752a7b7></i></span> <span data-v-5752a7b7>SKIN</span></div> <div class="inner" data-v-5752a7b7><div title="Default" class="color " style="background:#696969;" data-v-5752a7b7></div><div title="White &amp; Black" class="color " style="background:linear-gradient(120deg, #666666, #999999, #333333);" data-v-5752a7b7></div><div title="JShine" class="color active" style="background:linear-gradient(120deg, #ff3300, #cc66ff, #00ccff);" data-v-5752a7b7></div><div title="Memariani" class="color " style="background:linear-gradient(120deg, #cc6699, #6666cc, #33cccc);" data-v-5752a7b7></div></div> <div class="minimize" data-v-5752a7b7></div></div> <div class="Settings card" data-v-8ef0d620 data-v-68407f5a><div class="caption" data-v-8ef0d620><span class="icon" data-v-8ef0d620><i class="fas fa-cog fa-fw" data-v-8ef0d620></i></span> <span data-v-8ef0d620>SETTINGS</span></div> <div class="inner" data-v-8ef0d620><div class=" " data-v-8ef0d620><span class="icon" data-v-8ef0d620><i class="fas fa-adjust fa-fw"></i></span> <span data-v-8ef0d620>Night Shift</span> <div class="switch" data-v-8ef0d620></div></div><div class=" " data-v-8ef0d620><span class="icon" data-v-8ef0d620><i class="fas fa-video-slash fa-fw"></i></span> <span data-v-8ef0d620>Disable Canvas</span> <div class="switch" data-v-8ef0d620></div></div><div class="active " data-v-8ef0d620><span class="icon" data-v-8ef0d620><i class="fas fa-globe-asia fa-fw"></i></span> <span data-v-8ef0d620>简体中文</span> <div class="switch" data-v-8ef0d620></div></div></div> <div class="minimize" data-v-8ef0d620></div></div></div></div> <div class="center " data-v-5f6ffb84><div class="Translate card" data-v-bbd4da56 data-v-5f6ffb84><div class="bar " data-v-bbd4da56><div title="Highlight words to translate - Supported by Baidu Translation API" class="sq highlight" data-v-bbd4da56><i class="fas fa-highlighter" data-v-bbd4da56></i></div> <div class="locales" data-v-bbd4da56><div data-v-bbd4da56>中文</div> <span data-v-bbd4da56>|</span> <div data-v-bbd4da56>English</div> <span data-v-bbd4da56>|</span> <div data-v-bbd4da56>日本語</div> <!----></div> <div title="Click to copy highlighted content above translation bar" class="sq copy" data-v-bbd4da56><i class="fas fa-copy" data-v-bbd4da56></i></div></div> <!----></div> <div data-v-5f6ffb84><div class="Post" data-v-55aed3a6 data-v-5f6ffb84><div class="Article card fix " data-v-3caaac61 data-v-55aed3a6><div class="caption" data-v-3caaac61><span class="icon" data-v-3caaac61><i class="fas fa-file fa-fw" data-v-3caaac61></i></span> <span data-v-3caaac61>PAGE CONTENT</span></div> <div class="inner" data-v-3caaac61><div class="meta  " data-v-3caaac61><div class="meta-title" data-v-3caaac61>JavaWeb(二)</div> <div class="meta-info" data-v-3caaac61><div class="info-date" data-v-3caaac61><i class="fas fa-calendar-alt fa-fw" data-v-3caaac61></i>
          2022-03-22
        </div> <div class="info-updated" data-v-3caaac61><i class="fas fa-calendar-check fa-fw" data-v-3caaac61></i>
          2022-03-22
        </div> <div class="info-categories" data-v-3caaac61><i class="fas fa-folder-open fa-fw" data-v-3caaac61></i> <span data-v-3caaac61><!----> <a href="/category/web开发/" data-v-3caaac61>web开发</a></span></div> <div class="info-wordcount" data-v-3caaac61><i class="fas fa-file-word fa-fw" data-v-3caaac61></i>
          10.4k
        </div> <div class="info-wordcount" data-v-3caaac61><i class="fas fa-stopwatch fa-fw" data-v-3caaac61></i>
          90 min.
        </div></div></div> <div class="markdown-body content__default" data-v-3caaac61><h1 id="javaweb-二"><a href="#javaweb-二" class="header-anchor">#</a> JavaWeb（二）</h1> <p>学习视频：BV12J411M7Sj</p> <p>https://blog.csdn.net/INFINITE_WAR/article/details/123670628</p> <p>@[toc]</p> <h1 id="_8、jsp"><a href="#_8、jsp" class="header-anchor">#</a> 8、JSP</h1> <p><code>Java Server Pages</code>: Java服务端页面，和Servlet一样，用于动态web技术</p> <p>写法和html相近</p> <p>区别：</p> <ul><li>html只给用户静态数据</li> <li>jsp页面中可以潜伏java代码，可以给用户提供动态数据</li></ul> <h2 id="_8-1-jsp原理"><a href="#_8-1-jsp原理" class="header-anchor">#</a> 8.1 JSP原理</h2> <p>问：jsp是怎么运行的？</p> <ul><li><p>代码层面jsp没有变化</p></li> <li><p>服务器中</p> <p>(根据系统配置可能有所不同)查看自己的<code>用户/AppData/local/JetBrains/IntelliJidea/tomcat</code>路径中有一个work目录。</p> <p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/337f4b9616814ab1a40e65e94377c6c2.png#pic_center" loading="lazy" class="lazy"></p></li></ul> <p><strong>浏览器想服务器发送请求，不管访问什么资源，其实都在访问Servlet。</strong></p> <p>jsp最终会被转换成java类，这个类继承了Servlet</p> <p>jsp生成的类中有三个常见方法</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//初始化</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jspInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token comment">//销毁</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">_jspDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token comment">//JSPService</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">_jspService</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> var1<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> var2<span class="token punctuation">)</span> <span class="token punctuation">;</span>
</code></pre></div><ol><li><p>判断请求</p></li> <li><p>内置了一些对象</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">final</span> <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>jsp<span class="token punctuation">.</span></span>PageContext</span> pageContext<span class="token punctuation">;</span> <span class="token comment">//页面上下文</span>
<span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>HttpSession</span> session <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token comment">//session</span>
<span class="token keyword">final</span> <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>ServletContext</span> application<span class="token punctuation">;</span>  <span class="token comment">//applicationContext</span>
<span class="token keyword">final</span> <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>ServletConfig</span> config<span class="token punctuation">;</span>   <span class="token comment">//config</span>
<span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>jsp<span class="token punctuation">.</span></span>JspWriter</span> out <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token comment">//out</span>
<span class="token keyword">final</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Object</span> page <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>  <span class="token comment">//page：当前</span>
<span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">;</span>     <span class="token comment">//请求</span>
<span class="token class-name">HttpServletResponse</span>  response<span class="token punctuation">;</span>  <span class="token comment">//响应</span>
</code></pre></div></li> <li><p>输出页面前增加的代码</p> <div class="language-java extra-class"><pre class="language-java"><code>response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;text/html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//设置相应页面类型</span>
pageContext <span class="token operator">=</span> _jspxFactory<span class="token punctuation">.</span><span class="token function">getPageContext</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> request<span class="token punctuation">,</span> response<span class="token punctuation">,</span>
                                          <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">8192</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
_jspx_page_context <span class="token operator">=</span> pageContext<span class="token punctuation">;</span>
application <span class="token operator">=</span> pageContext<span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
config <span class="token operator">=</span> pageContext<span class="token punctuation">.</span><span class="token function">getServletConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
session <span class="token operator">=</span> pageContext<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
out <span class="token operator">=</span> pageContext<span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
_jspx_out <span class="token operator">=</span> out<span class="token punctuation">;</span>

out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;html&gt;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;body&gt;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;h2&gt;Hello Wd!&lt;/h2&gt;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;/body&gt;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;/html&gt;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>以上的对象可以在jsp中直接使用</p> <div class="language-jsp extra-class"><pre class="language-text"><code>&lt;html&gt;
&lt;body&gt;
&lt;h2&gt;Hello World!&lt;/h2&gt;
    
 &lt;%
    //这里调用java对象
    String name=&quot;alice&quot;;
    %&gt;   
name:&lt;%=name%&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div><p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/c5079341525047899f8d21156f4cb5b7.png?x-oss-process=image" loading="lazy" class="lazy"></p></li></ol> <p>​		在jsp页面中，java代码会原封不动地输出，html代码都会专用out.write写入。</p> <h2 id="_8-2-jsp基本语法"><a href="#_8-2-jsp基本语法" class="header-anchor">#</a> 8.2 JSP基本语法</h2> <p>需要的依赖</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--        servlet依赖--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.servlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>servlet-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--        jsp依赖--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.servlet.jsp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>javax.servlet.jsp-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.3.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--        JSTL表达式依赖--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.servlet.jsp.jstl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jstl-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--        standard标签库--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>taglibs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>standard<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>jsp支持java语法</strong></p> <h3 id="_8-2-1-jsp表达式"><a href="#_8-2-1-jsp表达式" class="header-anchor">#</a> 8.2.1 jsp表达式</h3> <blockquote><p>index.jsp</p></blockquote> <div class="language-jsp extra-class"><pre class="language-text"><code>&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;$Title$&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;

&lt;%--  JSP表达式
作用：将程序的输出放到客户端
用法   &lt;%= 变量或表达式%&gt;
--%&gt;
&lt;%= new java.util.Date()%&gt;

  &lt;/body&gt;
&lt;/html&gt;
</code></pre></div><p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/7414f2f605dd40cdab38a99baf90c15e.png?x-oss-process=image" loading="lazy" class="lazy"></p> <h3 id="_8-2-2-jsp脚本片段"><a href="#_8-2-2-jsp脚本片段" class="header-anchor">#</a> 8.2.2 jsp脚本片段</h3> <blockquote><p>index.jsp</p></blockquote> <div class="language-jsp extra-class"><pre class="language-text"><code>&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;$Title$&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;

&lt;%--  JSP表达式
作用：将程序的输出放到客户端
用法   &lt;%= 变量或表达式%&gt;
--%&gt;
&lt;%= new java.util.Date()%&gt;
&lt;%--jsp脚本片段--%&gt;

&lt;%
  int sum=0;
  for(int i=0;i&lt;50;i++){
    sum+=i;
    out.println(&quot;&lt;h1&gt;sum[&quot;+i+&quot;]=&quot;+sum+&quot;&lt;/h1&gt;&quot;);
  }
%&gt;

  &lt;/body&gt;
&lt;/html&gt;
</code></pre></div><p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/0ccd7fdb41ea4a5a9d4a69d4e44c7805.png?x-oss-process=image" loading="lazy" class="lazy"></p> <h3 id="_8-2-3-脚本片段再实现"><a href="#_8-2-3-脚本片段再实现" class="header-anchor">#</a> 8.2.3 脚本片段再实现</h3> <div class="language-jsp extra-class"><pre class="language-text"><code>&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;$Title$&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;


&lt;%--jsp脚本片段1--%&gt;

&lt;%
  int sum=0;
  for(int i=0;i&lt;50;i++){
    sum+=i;
    out.println(&quot;&lt;h1&gt;sum[&quot;+i+&quot;]=&quot;+sum+&quot;&lt;/h1&gt;&quot;);
  }
%&gt;
  
&lt;%--jsp脚本片段2--%&gt;
&lt;%
  int b=100;
%&gt;
      

  &lt;/body&gt;
&lt;/html&gt;
</code></pre></div><p>一个jsp页面下的脚本片段处于<u>同一个作用域中</u>。</p> <div class="language-jsp extra-class"><pre class="language-text"><code>&lt;%-- 在脚本中嵌入html元素--%&gt;
&lt;%
  for(int i=0;i&lt;5;i++){
%&gt;
&lt;h1&gt; xxxxxtyyyyy &lt;%=i%&gt; &lt;/h1&gt;
&lt;% }  %&gt;
</code></pre></div><h3 id="_8-2-4-jsp声明"><a href="#_8-2-4-jsp声明" class="header-anchor">#</a> 8.2.4 jsp声明</h3> <div class="language-jsp extra-class"><pre class="language-text"><code>&lt;%!
  static{
    System.out.println(&quot;loading page&quot;);
  }
  private int globalvar=110000;
  public void staticMethod(){
    System.out.println(&quot;this is a static method&quot;);
  }
%&gt;
</code></pre></div><p>注：JSP声明会被编译到JSP生成的java类中。其他的脚本会被生成到<code>_jspService</code>方法中。</p> <p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/d768c20a522849d293e1f1f52aa0c52e.png?x-oss-process=image" loading="lazy" class="lazy"></p> <div class="language-jsp extra-class"><pre class="language-text"><code>&lt;!--HTML注释--&gt;
&lt;%--JSP注释--%&gt;
</code></pre></div><p>HTML的注释可以在客户端显示，JSP注释不会。</p> <h2 id="_8-3-jsp指令"><a href="#_8-3-jsp指令" class="header-anchor">#</a> 8.3 jsp指令</h2> <div class="language-jsp extra-class"><pre class="language-text"><code>&lt;%@page args......%&gt;
&lt;%@ include file=&quot;xxx&quot;%&gt;
</code></pre></div><h3 id="自定义错误页面"><a href="#自定义错误页面" class="header-anchor">#</a> 自定义错误页面</h3> <blockquote><p>目录结构</p></blockquote> <p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/9794162f1c3541bcb0cc74df1aa0af1f.png?x-oss-process=image" loading="lazy" class="lazy"></p> <blockquote><p>index.jsp</p></blockquote> <div class="language-jsp extra-class"><pre class="language-text"><code>&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;%-- 如果不在web.xml中配置错误跳转的话，可以加上这一句
    &lt;%@ page errorPage=&quot;error/500.jsp&quot; %&gt;
--%&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;$Title$&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;

&lt;%
  //算数错误会跳转到500
  int x=1/0;
%&gt;

  &lt;/body&gt;
&lt;/html&gt;
</code></pre></div><blockquote><p>500.jsp</p></blockquote> <div class="language-jsp extra-class"><pre class="language-text"><code>&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;%--定制的500错误页面--%&gt;

&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1 align=&quot;center&quot; font-color=&quot;red&quot;&gt;500&lt;/h1&gt;
    &lt;img src=&quot;${pageContext.request.contextPath}/img/500page.png&quot; alt=&quot;null&quot;&gt;
&lt;/body&gt;
&lt;/html&gt;

</code></pre></div><blockquote><p>404.jsp</p></blockquote> <div class="language-jsp extra-class"><pre class="language-text"><code>&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1 align=&quot;center&quot; font-color=&quot;red&quot;&gt;404&lt;/h1&gt;
&lt;img src=&quot;${pageContext.request.contextPath}/img/404page.jpeg&quot; alt=&quot;null&quot;&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div><blockquote><p>web.xml</p></blockquote> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>error-page</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>error-code</span><span class="token punctuation">&gt;</span></span>404<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>error-code</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>location</span><span class="token punctuation">&gt;</span></span>/error/404.jsp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>location</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>error-page</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>error-page</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>error-code</span><span class="token punctuation">&gt;</span></span>500<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>error-code</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>location</span><span class="token punctuation">&gt;</span></span>/error/500.jsp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>location</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>error-page</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>测试效果</p></blockquote> <p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/523dbc7e5b554b6bb7122c322df5a895.png?x-oss-process=image" loading="lazy" class="lazy"></p> <h3 id="网页拼接"><a href="#网页拼接" class="header-anchor">#</a> 网页拼接</h3> <p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/372eb2a0f08c489f8a59797e5b529aaa.png?x-oss-process=image" loading="lazy" class="lazy"></p> <blockquote><p>header.jsp</p></blockquote> <div class="language-jsp extra-class"><pre class="language-text"><code>&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;h1&gt;我是header&lt;/h1&gt;
</code></pre></div><blockquote><p>footer.jsp</p></blockquote> <div class="language-jsp extra-class"><pre class="language-text"><code>&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;h1&gt;我是footer&lt;/h1&gt;
</code></pre></div><blockquote><p>index.jsp</p></blockquote> <div class="language-jsp extra-class"><pre class="language-text"><code>&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;%--&lt;%@ page errorPage=&quot;error/500.jsp&quot; %&gt;--%&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;$Title$&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;

&lt;%--  三个页面合并为一个，这里要注意合并的页面中是否有重名的变量--%&gt;
&lt;%@ include file=&quot;common/header.jsp&quot;%&gt;
&lt;h1&gt;网页主体&lt;/h1&gt;
&lt;%@ include file=&quot;common/footer.jsp&quot;%&gt;
&lt;hr&gt;

&lt;%--  jsp标签
  拼接页面，本质还是三个页面--%&gt;
  &lt;jsp:include page=&quot;common/header.jsp&quot;/&gt;
  &lt;h1&gt;网页主体&lt;/h1&gt;
  &lt;jsp:include page=&quot;common/footer.jsp&quot;/&gt;

  &lt;/body&gt;
&lt;/html&gt;
</code></pre></div><p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/b2cd1374765c4571b0b5a03de63d1dfb.png?x-oss-process=image" loading="lazy" class="lazy"></p> <h2 id="_8-4-9个内置对象"><a href="#_8-4-9个内置对象" class="header-anchor">#</a> 8.4 9个内置对象</h2> <ul><li>PageContext   存储</li> <li>Request   存储</li> <li>Response</li> <li>Session   存储</li> <li>Application    ServletContext   存储</li> <li>config   ServletConfig</li> <li>out</li> <li>page   不用了解</li> <li>exception</li></ul> <div class="language-jsp extra-class"><pre class="language-text"><code>&lt;%
    //保存的数据只在一个页面中有效
    pageContext.setAttribute(&quot;name1&quot;,&quot;robot1&quot;);
    //保存的数据只在一次请求中有效，请求转发会携带这个数据
    request.setAttribute(&quot;name2&quot;,&quot;robot2&quot;);
    //保存的数据只在一次会话中有效，从打开浏览器到关闭浏览器
    session.setAttribute(&quot;name3&quot;,&quot;robot3&quot;);
    //保存的数据只在服务器中有效，从打开服务器到关闭服务器
    application.setAttribute(&quot;name4&quot;,&quot;robot4&quot;);
%&gt;
</code></pre></div><p>request：客户端向服务器发送请求，产生的数据，用户看完就没用了。如：新闻，看完就可以直接删除。</p> <p>session：客户端向服务器发送请求，产生的数据，用户用完后可能还会用。如：购物车。</p> <p>application：客户端向服务器发送请求，产生的数据，一个用户用完了，其他用户还可能使用。如：聊天程序。</p> <h2 id="_8-5-jsp标签、jstl标签、el表达式"><a href="#_8-5-jsp标签、jstl标签、el表达式" class="header-anchor">#</a> 8.5 JSP标签、JSTL标签、EL表达式</h2> <p>需要的依赖</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!--        JSTL表达式依赖--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.servlet.jsp.jstl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jstl-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!--        standard标签库--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>taglibs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>standard<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>EL表达式：<code>${}</code></p> <ul><li>获取数据</li> <li>执行运算</li> <li>获取web开发的常用对象（不常用）</li></ul> <h3 id="jsp表达式"><a href="#jsp表达式" class="header-anchor">#</a> jsp表达式</h3> <blockquote><p>参数传递测试</p></blockquote> <div class="language-jsp extra-class"><pre class="language-text"><code>&lt;%--jsptag.jsp--%&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;%--
  http://localhost:8080/jsptag.jsp?name=infinite&amp;age=123
--%&gt;


&lt;jsp:forward page=&quot;/jsptag2.jsp&quot;&gt;
    &lt;jsp:param name=&quot;name&quot; value=&quot;infinite&quot;&gt;&lt;/jsp:param&gt;
    &lt;jsp:param name=&quot;age&quot; value=&quot;123&quot;&gt;&lt;/jsp:param&gt;
&lt;/jsp:forward&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre></div><div class="language-jsp extra-class"><pre class="language-text"><code>&lt;%--jsptag2.jsp--%&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;%--取出参数--%&gt;
用户： &lt;%=request.getParameter(&quot;name&quot;)%&gt;
age：&lt;%=request.getParameter(&quot;age&quot;)%&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre></div><p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/2e1f5c546fa043858e38e5c3bc40a379.png#pic_center" loading="lazy" class="lazy"></p> <h3 id="jstl标签"><a href="#jstl标签" class="header-anchor">#</a> JSTL标签</h3> <p>https://www.runoob.com/jsp/jsp-jstl.html</p> <p>目的：扩展标签的功能</p> <p><strong>核心标签  （重要）</strong></p> <p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/3e72852af1de4d55a8b85bb8856ebcd4.png?x-oss-process=image" loading="lazy" class="lazy"></p> <p><strong>格式化标签</strong></p> <p><strong>SQL标签</strong></p> <p><strong>XML标签</strong></p> <blockquote><p>JSTL使用步骤</p></blockquote> <ul><li>引入对于的taglib</li> <li>使用其中的方法</li> <li>在tomcat中要引入相关的jstl包，否则会报错：JSTL解析错误</li></ul> <h4 id="管理员登录"><a href="#管理员登录" class="header-anchor">#</a> 管理员登录</h4> <blockquote><p>coretag.jsp</p></blockquote> <div class="language-jsp extra-class"><pre class="language-text"><code>&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;%--通过 taglib引入标签库--%&gt;
&lt;%-- 标签库的位置上网复制即可--%&gt;

&lt;%@ taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;
&lt;%@ taglib prefix=&quot;x&quot; uri=&quot;http://java.sun.com/jsp/jstl/xml&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h4&gt;if 测试&lt;/h4&gt;
&lt;hr&gt;


&lt;form action=&quot;coretag.jsp&quot; method=&quot;get&quot;&gt;
    &lt;%--
      EL表达式获取表单中的数据
      ${param.参数名}
    --%&gt;
    &lt;input type=&quot;text&quot; name=&quot;username&quot; value=&quot;${param.username}&quot;&gt;
    &lt;input type=&quot;submit&quot; value=&quot;登录&quot;&gt;
&lt;/form&gt;

&lt;%--判断是不是管理员--%&gt;
&lt;c:if test=&quot;${param.username=='admin'}&quot; var=&quot;isadmin&quot;&gt;
    &lt;c:out value=&quot;管理员登录&quot;/&gt;
&lt;/c:if&gt;
&lt;c:out value=&quot;${isadmin}&quot;&gt;&lt;/c:out&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre></div><blockquote><p>测试结果</p></blockquote> <p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/412fda031bdf4f05876935b3e9ff1866.png?x-oss-process=image" loading="lazy" class="lazy"></p> <h4 id="成绩评定"><a href="#成绩评定" class="header-anchor">#</a> 成绩评定</h4> <blockquote><p>corewhen.jsp</p></blockquote> <div class="language-jsp extra-class"><pre class="language-text"><code>&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;%@ taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;
&lt;%@ taglib prefix=&quot;x&quot; uri=&quot;http://java.sun.com/jsp/jstl/xml&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;%--定义一个变量score  值为85--%&gt;
&lt;c:set var=&quot;score&quot; value=&quot;85&quot;/&gt;

&lt;c:choose&gt;
    &lt;c:when test=&quot;${score&gt;=90}&quot;&gt;
        A
    &lt;/c:when&gt;
    &lt;c:when test=&quot;${score&gt;=80}&quot;&gt;
        B
    &lt;/c:when&gt;
    &lt;c:when test=&quot;${score&gt;=70}&quot;&gt;
        C
    &lt;/c:when&gt;
    &lt;c:when test=&quot;${score&gt;=60}&quot;&gt;
        D
    &lt;/c:when&gt;
    &lt;c:when test=&quot;${score&lt;60}&quot;&gt;
        E
    &lt;/c:when&gt;
&lt;/c:choose&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre></div><h4 id="遍历数组"><a href="#遍历数组" class="header-anchor">#</a> 遍历数组</h4> <div class="language-jsp extra-class"><pre class="language-text"><code>&lt;%@ page import=&quot;java.util.ArrayList&quot; %&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;%@ taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;
&lt;%@ taglib prefix=&quot;x&quot; uri=&quot;http://java.sun.com/jsp/jstl/xml&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;%
    ArrayList&lt;String&gt; people = new ArrayList&lt;&gt;();
    people.add(0,&quot;张三&quot;);
    people.add(1,&quot;李四&quot;);
    people.add(2,&quot;王五&quot;);
    people.add(3,&quot;赵六&quot;);
    people.add(4,&quot;田七&quot;);
    request.setAttribute(&quot;list&quot;,people);
%&gt;

&lt;%--var  每次遍历的变量
    items  要遍历的对象
--%&gt;
&lt;c:forEach var=&quot;people&quot; items=&quot;${list}&quot;&gt;
    &lt;c:out value=&quot;${people}&quot;/&gt;&lt;br&gt;
&lt;/c:forEach&gt;
&lt;hr&gt;

&lt;%--   for(int i=1;i&lt;=3;i+=2)--%&gt;
&lt;c:forEach var=&quot;people&quot; items=&quot;${list}&quot; begin=&quot;1&quot; end=&quot;3&quot; step=&quot;2&quot;&gt;
    &lt;c:out value=&quot;${people}&quot;/&gt; &lt;br&gt;
&lt;/c:forEach&gt;


&lt;/body&gt;
&lt;/html&gt;
</code></pre></div><h1 id="_9、javabean"><a href="#_9、javabean" class="header-anchor">#</a> 9、JavaBean</h1> <p>实体类</p> <p>JavaBean有特定的写法：</p> <ul><li>必须要有一个无参构造</li> <li>属性必须私有化</li> <li>必须有对应的get/set方法</li></ul> <p>一般用来和数据库的字段做映射  ORM(对象关系映射)</p> <ul><li>表--&gt;类</li> <li>字段--&gt;属性</li> <li>行记录--&gt;对象</li></ul> <blockquote><p>People.java</p> <p>假设有一个存储个人信息的数据表。people对象代表相关记录</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>pojo</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">People</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> address<span class="token punctuation">;</span>

    <span class="token comment">//constructor()</span>
    <span class="token comment">//getter() and setter()</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>javabean.jsp</p></blockquote> <div class="language-jsp extra-class"><pre class="language-text"><code>&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;%
    //People people=new People();
    //people.setAddress();
    //.....
    //people.getAddress();
    //.....
%&gt;

&lt;jsp:useBean id=&quot;people&quot; class=&quot;com.infinite.pojo.People&quot;/&gt;
&lt;jsp:setProperty name=&quot;people&quot; property=&quot;address&quot; value=&quot;A市&quot;/&gt;
&lt;jsp:setProperty name=&quot;people&quot; property=&quot;age&quot; value=&quot;18&quot;/&gt;
&lt;jsp:setProperty name=&quot;people&quot; property=&quot;id&quot; value=&quot;250&quot;/&gt;
&lt;jsp:setProperty name=&quot;people&quot; property=&quot;name&quot; value=&quot;alice&quot;/&gt;

姓名：&lt;jsp:getProperty name=&quot;people&quot; property=&quot;name&quot;/&gt;
id：&lt;jsp:getProperty name=&quot;people&quot; property=&quot;id&quot;/&gt;
年龄：&lt;jsp:getProperty name=&quot;people&quot; property=&quot;age&quot;/&gt;
地址：&lt;jsp:getProperty name=&quot;people&quot; property=&quot;address&quot;/&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre></div><blockquote><p>测试效果</p></blockquote> <p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/dd3cd61353ae43e5bacb460fb3f3c527.png#pic_center" loading="lazy" class="lazy"></p> <h1 id="_10、mvc三层架构"><a href="#_10、mvc三层架构" class="header-anchor">#</a> 10、MVC三层架构</h1> <p>MVC： Model、view、Controller     模型、视图、控制器</p> <h2 id="_10-1-早期的架构"><a href="#_10-1-早期的架构" class="header-anchor">#</a> 10.1 早期的架构</h2> <p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/70181bcd8960476aa7af2a460898f5f7.png?x-oss-process=image" loading="lazy" class="lazy"></p> <p>用户直接访问控制层，控制层可以直接操作数据库</p> <div class="language- extra-class"><pre class="language-text"><code>servlet--&gt;CRUD--&gt;db
缺点：程序臃肿，难维护
servlet的代码包括：处理请求、响应、试图跳转、处理JDBC、处理业务代码、处理逻辑代码

JDBC作为数据库操作的中间件，相当于在控制层和数据库之间又多了一层，用于解决Mysql、Oracle、SqlServer等不同厂商数据库的兼容性问题。同样的中间件还有ODBC、QODBC(QT相关)
</code></pre></div><p>注：虽然JSP也可以嵌入java代码，但是为了加强代码的可维护性，要尽量避免这么做。其他层同理。</p> <h2 id="_10-2、改进的mvc三层架构"><a href="#_10-2、改进的mvc三层架构" class="header-anchor">#</a> 10.2、改进的MVC三层架构</h2> <p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/42019bab41974053aee688e3f6b8e363.png?x-oss-process=image" loading="lazy" class="lazy"></p> <p>Model</p> <ul><li>业务处理：业务逻辑（Service）</li> <li>数据持久层：CRUD（Dao）</li></ul> <p>View</p> <ul><li>展示数据</li> <li>提供链接发起Servlet请求（a、form、img......）</li></ul> <p>Controller（Servlet）</p> <ul><li>接受用户请求：（req：请求参数、session信息）</li> <li>交给业务层处理对应的代码</li> <li>控制视图的跳转</li></ul> <p>一个登录的流程</p> <div class="language- extra-class"><pre class="language-text"><code>登录--&gt;接受用户的登录请求--&gt;处理用户的请求（获取用户的登录参数：username、password）--&gt;交给业务层处理登陆业务（判断用户名密码是否正确：事务）--&gt;Dao层查询用户名和密码是否正确--&gt;db
</code></pre></div><h1 id="_11、filter-过滤器"><a href="#_11、filter-过滤器" class="header-anchor">#</a> 11、Filter（过滤器）</h1> <p>目的：过滤网站的数据</p> <ul><li>处理中文乱码</li> <li>登录验证</li></ul> <p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/76235db6fe0b45d8b459b1820dbef8f2.png?x-oss-process=image" loading="lazy" class="lazy"></p> <p>跟Servlet一样，要实现过滤器，可以通过相关的接口实现。</p> <h2 id="_11-1-将消息过滤为utf-8编码"><a href="#_11-1-将消息过滤为utf-8编码" class="header-anchor">#</a> 11.1 将消息过滤为utf-8编码</h2> <blockquote><p>目录</p></blockquote> <p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/ce7da6f9437a4892a1a1f246c9ec7970.png?x-oss-process=image" loading="lazy" class="lazy"></p> <blockquote><p>ShowServlet.java</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>servlet</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServlet</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShowServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//resp.setCharacterEncoding(&quot;utf-8&quot;);  该操作交给过滤器实现</span>
        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;张三李四&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//若不加处理会直接显示一堆问号</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">doPost</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>CharacterEncodingFilter</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>filter</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CharacterEncodingFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span>
    <span class="token comment">//初始化</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">FilterConfig</span> filterConfig<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;CharacterEncodingFilter初始化完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//chain: 链。可能有好几个过滤器</span>
    <span class="token comment">/*
    1.过滤器中的所有代码，在过滤特定请求的时候都会执行
    2.必须要让过滤器执行
    filterChain.doFilter(servletRequest,servletResponse)方法
    * */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> servletRequest<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> servletResponse<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        servletRequest<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        servletResponse<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        servletResponse<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;text/html;charset=utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;过滤器执行前&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>servletRequest<span class="token punctuation">,</span>servletResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//让请求继续执行，否则程序会被截止</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;过滤器执行后&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//销毁：web服务器关闭后，过滤器会销毁</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;CharacterEncodingFilter已销毁&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/4b7ccb4cb71e41f0a37a0d554a14e1d0.png?x-oss-process=image" loading="lazy" class="lazy"></p> <blockquote><p>web.xml</p></blockquote> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-app</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://xmlns.jcp.org/xml/ns/javaee<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>4.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">&gt;</span></span>ShowServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">&gt;</span></span>com.infinite.servlet.ShowServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">&gt;</span></span>ShowServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">&gt;</span></span>/servlet/show<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">&gt;</span></span>CharacterEncodingFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-class</span><span class="token punctuation">&gt;</span></span>com.infinite.filter.CharacterEncodingFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-class</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-mapping</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">&gt;</span></span>CharacterEncodingFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--        只要是/servlet下的请求，都会经过这个过滤器--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">&gt;</span></span>/servlet/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-mapping</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-app</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>测试效果</p></blockquote> <p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/fbf666c79a4f480b8d1460ce66205f6e.png#pic_center" loading="lazy" class="lazy"></p> <p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/f9b5378224764e34998d3a228589f7cb.png?x-oss-process=image" loading="lazy" class="lazy"></p> <h1 id="_12、监听器"><a href="#_12、监听器" class="header-anchor">#</a> 12、监听器</h1> <p><u>现已不常用</u></p> <p>实现一个监听器接口，用以观察并反馈用户的动作</p> <h2 id="查看同时在线人数"><a href="#查看同时在线人数" class="header-anchor">#</a> 查看同时在线人数</h2> <blockquote><p>OnlineCountListener.java</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>listener</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletContext</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpSessionEvent</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpSessionListener</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OnlineCountListener</span> <span class="token keyword">implements</span> <span class="token class-name">HttpSessionListener</span> <span class="token punctuation">{</span>
    <span class="token comment">//创建session监听器</span>
    <span class="token comment">//一旦创建session就会触发这个事件</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sessionCreated</span><span class="token punctuation">(</span><span class="token class-name">HttpSessionEvent</span> httpSessionEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ServletContext</span> ctx <span class="token operator">=</span> httpSessionEvent<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Integer</span> onlineCount<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> ctx<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;OnlineCount&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>onlineCount<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            onlineCount<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">int</span> count<span class="token operator">=</span>onlineCount<span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            onlineCount<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span>count<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        ctx<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;OnlineCount&quot;</span><span class="token punctuation">,</span>onlineCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//销毁session监听器</span>
    <span class="token comment">//一旦销毁session就会触发这个事件</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sessionDestroyed</span><span class="token punctuation">(</span><span class="token class-name">HttpSessionEvent</span> httpSessionEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ServletContext</span> ctx <span class="token operator">=</span> httpSessionEvent<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Integer</span> onlineCount<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> ctx<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;OnlineCount&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>httpSessionEvent<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>onlineCount<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            onlineCount<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">int</span> count<span class="token operator">=</span>onlineCount<span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            onlineCount<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span>count<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        ctx<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;OnlineCount&quot;</span><span class="token punctuation">,</span>onlineCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/*
session的销毁：
1.手动销毁   getSession().invalidate();
2.自动销毁   web.xml中自定义session过期时间
* */</span>
</code></pre></div><blockquote><p>index.jsp</p></blockquote> <div class="language-jsp extra-class"><pre class="language-text"><code>&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;$Title$&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;

  &lt;h1&gt;当前有&lt;span&gt;&lt;%=this.getServletConfig().getServletContext().getAttribute(&quot;OnlineCount&quot;)%&gt;&lt;/span&gt;&lt;/h1&gt;


  &lt;/body&gt;
&lt;/html&gt;
</code></pre></div><blockquote><p>web.xml</p></blockquote> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!--    注册监听器--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>listener</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>listener-class</span><span class="token punctuation">&gt;</span></span>com.infinite.listener.OnlineCountListener<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>listener-class</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>listener</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>session-config</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>session-timeout</span><span class="token punctuation">&gt;</span></span>10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>session-timeout</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>session-config</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>测试效果</p></blockquote> <p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/d03b23881ff84bd7a66312b82e5a3e89.png?x-oss-process=image" loading="lazy" class="lazy"></p> <h1 id="_13、过滤器、监听器的常见应用"><a href="#_13、过滤器、监听器的常见应用" class="header-anchor">#</a> 13、过滤器、监听器的常见应用</h1> <p>监听器：GUI中常用</p> <h2 id="用户登录跳转"><a href="#用户登录跳转" class="header-anchor">#</a> 用户登录跳转</h2> <p>需求：用户登录后才能进入主页，注销后不能再进入主页</p> <ol><li><p>用户登录后，向Session中放入用户的数据</p></li> <li><p>进入主页的时候要判断用户是否已经登录。（用过滤器实现）</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> servletRequest<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> servletResponse<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>

    <span class="token class-name">HttpServletRequest</span> request<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> servletRequest<span class="token punctuation">;</span>
    <span class="token class-name">HttpServletResponse</span> response<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">)</span> servletResponse<span class="token punctuation">;</span>



    <span class="token keyword">if</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span>USER_SESSION<span class="token punctuation">)</span><span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">&quot;/error.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>servletRequest<span class="token punctuation">,</span>servletResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <blockquote><p>目录</p></blockquote> <p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/553d0faebc1d493eb378cc9abaf7539d.png?x-oss-process=image" loading="lazy" class="lazy"></p> <h3 id="sysfilter-java"><a href="#sysfilter-java" class="header-anchor">#</a> SysFilter.java</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>filter</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Constant</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SysFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">FilterConfig</span> filterConfig<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> servletRequest<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> servletResponse<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>

        <span class="token class-name">HttpServletRequest</span> request<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> servletRequest<span class="token punctuation">;</span>
        <span class="token class-name">HttpServletResponse</span> response<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">)</span> servletResponse<span class="token punctuation">;</span>


        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span>USER_SESSION<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span>USER_SESSION<span class="token punctuation">)</span><span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            response<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">&quot;/error.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="loginservlet"><a href="#loginservlet" class="header-anchor">#</a> LoginServlet</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>servlet</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Constant</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServlet</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//获取前端请求参数</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>username<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//登录成功</span>
            req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span>USER_SESSION<span class="token punctuation">,</span>req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">&quot;/sys/success.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span><span class="token punctuation">{</span>
            resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">&quot;/error.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token function">doGet</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="logoutservlet"><a href="#logoutservlet" class="header-anchor">#</a> LogoutServlet</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>servlet</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Constant</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServlet</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogoutServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> user_session<span class="token operator">=</span>req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span>USER_SESSION<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>user_session<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span>USER_SESSION<span class="token punctuation">)</span><span class="token punctuation">;</span>
            resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">&quot;/login.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span><span class="token punctuation">{</span>
            resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">&quot;/login.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token function">doGet</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="login-jsp"><a href="#login-jsp" class="header-anchor">#</a> login.jsp</h3> <div class="language-jsp extra-class"><pre class="language-text"><code>&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;h1&gt;登录&lt;/h1&gt;

&lt;form action=&quot;/servlet/login&quot; method=&quot;post&quot;&gt;
    &lt;input type=&quot;text&quot; name=&quot;username&quot; required&gt;
    &lt;input type=&quot;submit&quot;&gt;

&lt;/form&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre></div><h3 id="error-jsp"><a href="#error-jsp" class="header-anchor">#</a> error.jsp</h3> <div class="language-jsp extra-class"><pre class="language-text"><code>&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1 align=&quot;center&quot; font-color=&quot;red&quot;&gt;用户名错误或没有权限&lt;/h1&gt;
&lt;a href=&quot;/login.jsp&quot;&gt;返回登录页面&lt;/a&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div><h3 id="sys-success-jsp"><a href="#sys-success-jsp" class="header-anchor">#</a> sys/success.jsp</h3> <div class="language-jsp extra-class"><pre class="language-text"><code>&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;h1&gt;主页&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;/servlet/logout&quot;&gt;注销&lt;/a&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div><h3 id="web-xml"><a href="#web-xml" class="header-anchor">#</a> web.xml</h3> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">&gt;</span></span>LoginServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">&gt;</span></span>com.infinite.servlet.LoginServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">&gt;</span></span>LoginServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">&gt;</span></span>/servlet/login<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">&gt;</span></span>LogoutServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">&gt;</span></span>com.infinite.servlet.LogoutServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">&gt;</span></span>LogoutServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">&gt;</span></span>/servlet/logout<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">&gt;</span></span>



<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">&gt;</span></span>SysFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-class</span><span class="token punctuation">&gt;</span></span>com.infinite.filter.SysFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-class</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-mapping</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">&gt;</span></span>SysFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">&gt;</span></span>/sys/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-mapping</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="测试效果"><a href="#测试效果" class="header-anchor">#</a> 测试效果</h3> <p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/00bc6025120445bfbdaffdd1e99b5bd7.png?x-oss-process=image" loading="lazy" class="lazy"></p> <h1 id="_14、jdbc"><a href="#_14、jdbc" class="header-anchor">#</a> 14、JDBC</h1> <p>目的：为不同厂商的数据库提供统一驱动接口</p> <p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/0af6788f3d7447cd957d132b0813f18d.png?x-oss-process=image" loading="lazy" class="lazy"></p> <h2 id="_14-1、基本用法"><a href="#_14-1、基本用法" class="header-anchor">#</a> 14.1、基本用法</h2> <blockquote><p>users表</p></blockquote> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>users<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>password<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>email<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>birthday<span class="token punctuation">`</span></span> <span class="token keyword">date</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8mb4_0900_ai_ci<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> users<span class="token punctuation">(</span>id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>password<span class="token punctuation">,</span>email<span class="token punctuation">,</span>birthday<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'张三'</span><span class="token punctuation">,</span><span class="token string">'123456'</span><span class="token punctuation">,</span><span class="token string">'zs@qq.com'</span><span class="token punctuation">,</span><span class="token string">'2000-01-01'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> users<span class="token punctuation">(</span>id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>password<span class="token punctuation">,</span>email<span class="token punctuation">,</span>birthday<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'李四'</span><span class="token punctuation">,</span><span class="token string">'123456'</span><span class="token punctuation">,</span><span class="token string">'ls@qq.com'</span><span class="token punctuation">,</span><span class="token string">'2000-01-01'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> users<span class="token punctuation">(</span>id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>password<span class="token punctuation">,</span>email<span class="token punctuation">,</span>birthday<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'王五'</span><span class="token punctuation">,</span><span class="token string">'123456'</span><span class="token punctuation">,</span><span class="token string">'ww@qq.com'</span><span class="token punctuation">,</span><span class="token string">'2000-01-01'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>pom.xml</p></blockquote> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.47<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>TestJdbc.java</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>jdbc</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestJdbc</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">,</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token comment">//配置信息</span>
        <span class="token comment">//useUnicode=true&amp;characterEncoding=utf-8  用以防止中文乱码</span>
        <span class="token class-name">String</span> url<span class="token operator">=</span><span class="token string">&quot;jdbc:mysql://localhost:3306/jdbc?useUnicode=true&amp;characterEncoding=utf-8&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> username<span class="token operator">=</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> password<span class="token operator">=</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">//1.加载驱动</span>
        <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;com.mysql.jdbc.Driver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.连接数据库 。 数据库对象</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.向数据库发送SQL语句的对象statement。可用于执行SQL语句</span>
        <span class="token class-name">Statement</span> statement <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//4.编写SQL。此处返回查询的结果集</span>
        <span class="token class-name">String</span> sql<span class="token operator">=</span><span class="token string">&quot;select * from users&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">ResultSet</span> resultSet <span class="token operator">=</span> statement<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//4.1增删改</span>
        <span class="token comment">//sql=&quot;delete from users where id=a&quot;;</span>
        <span class="token comment">//int i=statement.executeUpdate(sql);</span>


        <span class="token keyword">while</span><span class="token punctuation">(</span>resultSet<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;id=&quot;</span><span class="token operator">+</span>resultSet<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;name=&quot;</span><span class="token operator">+</span>resultSet<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;password=&quot;</span><span class="token operator">+</span>resultSet<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;email=&quot;</span><span class="token operator">+</span>resultSet<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;birthday=&quot;</span><span class="token operator">+</span>resultSet<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token string">&quot;birthday&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//6.关闭数据库连接</span>
        resultSet<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        statement<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>测试效果</p></blockquote> <p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/8cd646a9b5ea4e5d9fdd05834fc2af1e.png?x-oss-process=image" loading="lazy" class="lazy"></p> <h2 id="_14-2-预编译sql用法"><a href="#_14-2-预编译sql用法" class="header-anchor">#</a> 14.2 预编译sql用法</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>jdbc</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestJdbc2</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//配置信息</span>
        <span class="token comment">//useUnicode=true&amp;characterEncoding=utf-8  用以防止中文乱码</span>
        <span class="token class-name">String</span> url<span class="token operator">=</span><span class="token string">&quot;jdbc:mysql://localhost:3306/jdbc?useUnicode=true&amp;characterEncoding=utf-8&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> username<span class="token operator">=</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> password<span class="token operator">=</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">//1.加载驱动</span>
        <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;com.mysql.jdbc.Driver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.连接数据库。 数据库对象</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.使用预编译SQL</span>
        <span class="token class-name">String</span> sql<span class="token operator">=</span><span class="token string">&quot;insert into users(id,name,password,email,birthday) value(?,?,?,?,?);&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">//4.预编译</span>
        <span class="token class-name">PreparedStatement</span> preparedStatement <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>

        preparedStatement<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//给第一个'?'占位符设置值</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;赵六&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//给第二个'?'占位符设置值</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">&quot;zl@qq.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">setDate</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span>Date</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//5.执行SQL</span>
        <span class="token keyword">int</span> i<span class="token operator">=</span>preparedStatement<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;插入成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//6.关闭数据库连接</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="junit单元测试"><a href="#junit单元测试" class="header-anchor">#</a> junit单元测试</h2> <p>@Test</p> <blockquote><p>pom.xml</p></blockquote> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!--        单元测试--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.8.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.47<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.testng<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>testng<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>compile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>TestJdbc3.java</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>jdbc</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>testng<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestJdbc3</span> <span class="token punctuation">{</span>
    <span class="token comment">//这里可以直接运行，不必启动main方法</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>测试效果</p></blockquote> <p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/f03ec130e54b4db7a078202ce0c1e396.png?x-oss-process=image" loading="lazy" class="lazy"></p> <h2 id="事务"><a href="#事务" class="header-anchor">#</a> 事务</h2> <p>ACID:原子性、一致性、隔离性、持久性。 目的：保护数据的安全</p> <div class="language- extra-class"><pre class="language-text"><code>开启事务
事务提交
事务回滚
关闭事务

A：1000
B：1000

A(900)--100--&gt;B(1100)
</code></pre></div><blockquote><p>account表</p></blockquote> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>account<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>money<span class="token punctuation">`</span></span> <span class="token keyword">float</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">4</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8mb4_0900_ai_ci<span class="token punctuation">;</span>


<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> account<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span>money<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> account<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span>money<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> account<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span>money<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'C'</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>TestJdbc3.java</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>jdbc</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>testng<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">Connection</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">DriverManager</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">SQLException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestJdbc3</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//配置信息</span>
        <span class="token comment">//useUnicode=true&amp;characterEncoding=utf-8  用以防止中文乱码</span>
        <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">&quot;jdbc:mysql://localhost:3306/jdbc?useUnicode=true&amp;characterEncoding=utf-8&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">Connection</span> connection<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//1.加载驱动</span>
            <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;com.mysql.jdbc.Driver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//2.连接数据库 。 数据库对象</span>
            connection <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//3.通知数据库开启事务。此处关闭了自动提交</span>
            connection<span class="token punctuation">.</span><span class="token function">setAutoCommit</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;update account set money=money-100 where name-'A'&quot;</span><span class="token punctuation">;</span>
            connection<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//制造异常</span>
            <span class="token comment">//int i = 1 / 0;</span>

            <span class="token class-name">String</span> sql2 <span class="token operator">=</span> <span class="token string">&quot;update account set money=money-100 where name-'B'&quot;</span><span class="token punctuation">;</span>
            connection<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            connection<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">try</span><span class="token punctuation">{</span>
                connection<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e1<span class="token punctuation">)</span><span class="token punctuation">{</span>
                e1<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h1 id="项目-超市订单管理系统-smbms"><a href="#项目-超市订单管理系统-smbms" class="header-anchor">#</a> 项目：超市订单管理系统（SMBMS）</h1> <h2 id="需求"><a href="#需求" class="header-anchor">#</a> 需求</h2> <p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/1c4a012db933452da5ea5b977704b746.png?x-oss-process=image" loading="lazy" class="lazy"></p> <p>数据库对象：</p> <p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/8b7c7f65221840fd8d105fbc6276d363.png?x-oss-process=image" loading="lazy" class="lazy"></p> <h2 id="项目搭建准备工作"><a href="#项目搭建准备工作" class="header-anchor">#</a> 项目搭建准备工作</h2> <ol><li><p>搭建一个maven项目</p></li> <li><p>配置tomcat并测试</p></li> <li><p>导入jar包（依赖）</p> <ol><li>jsp、servlet、mysql驱动、jstl、standard等</li></ol></li> <li><p>创建项目包结构（pojo用于存实体类）</p> <p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/9bd7ae3d3594476a9e61eeada672d0ed.png?x-oss-process=image" loading="lazy" class="lazy"></p></li> <li><p>对应数据库编写实体类（ORM映射：表-类映射）</p></li> <li><p>编写基础公共类</p> <ol><li>数据库配置文件</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># resources/db.properties</span>
<span class="token assign-left variable">driver</span><span class="token operator">=</span>com.mysql.jdbc.Driver
<span class="token assign-left variable">url</span><span class="token operator">=</span>jdbc:mysql://localhost:3306/smbms?useSSL<span class="token operator">=</span>true<span class="token operator">&amp;</span><span class="token assign-left variable">useUnicode</span><span class="token operator">=</span>true<span class="token operator">&amp;</span><span class="token assign-left variable">characterEncoding</span><span class="token operator">=</span>utf-8
<span class="token assign-left variable">username</span><span class="token operator">=</span>root
<span class="token assign-left variable">password</span><span class="token operator">=</span>a13587491757A
</code></pre></div><ol start="2"><li><p>编写操作数据库的类</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author ShmeBluk
 * @version 1.0
 * @ClassName: BaseDAO
 * @Desc: 数据库操作基类
 * @package com.infinite.dao
 * @project smbms
 * @date
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BaseDao</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> driver<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> url<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> user<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 静态代码块,读取配置信息
     */</span>
    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token class-name">Properties</span> prop <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">InputStream</span> is <span class="token operator">=</span> <span class="token class-name">BaseDao</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">&quot;db.properties&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            prop<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>is<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        driver <span class="token operator">=</span> prop<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;driver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        url <span class="token operator">=</span> prop<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;url&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user <span class="token operator">=</span> prop<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        password <span class="token operator">=</span> prop<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @return Connection
     * @throws ClassNotFoundException
     * @throws SQLException
     * @Desc 获取数据库连接
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Connection</span> <span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">,</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>driver<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> user<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> conn<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @param conn
     * @param args
     * @return ResultSet 查询结果集
     * @throws SQLException
     * @Desc 通用的查询操作
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ResultSet</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span> <span class="token class-name">String</span> sql<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token class-name">PreparedStatement</span> ps <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> args<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ps<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> args<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> ps<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rs<span class="token punctuation">.</span><span class="token function">getMetaData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> rs<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @param conn
     * @param sql
     * @param args
     * @return int 受影响的行数
     * @throws SQLException
     * @Desc 通用的增删改操作
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span> <span class="token class-name">String</span> sql<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token class-name">PreparedStatement</span> ps <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> args<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ps<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> args<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">int</span> column <span class="token operator">=</span> ps<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> column<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @Desc  关闭资源操作
     * @param resultSet ResultSet
     * @param ps PreparedStatement
     * @param conn Connection
     * @return boolean 是否修改成功
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">closeResource</span><span class="token punctuation">(</span><span class="token class-name">ResultSet</span> resultSet<span class="token punctuation">,</span> <span class="token class-name">PreparedStatement</span> ps<span class="token punctuation">,</span> <span class="token class-name">Connection</span> conn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>resultSet <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                resultSet<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> throwables<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            throwables<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>ps <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                ps<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> throwables<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            throwables<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>conn <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> throwables<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            throwables<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> flag<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>编写字符编码过滤器（Filter/CharacterEncodingFilter.java）</p></li></ol></li> <li><p>导入静态资源</p></li></ol> <h2 id="登录功能"><a href="#登录功能" class="header-anchor">#</a> 登录功能</h2> <p>流程图：</p> <p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/8221ca87d148400daea5d5aaa3028de1.png?x-oss-process=image" loading="lazy" class="lazy"></p> <ol><li><p>编写前端页面</p></li> <li><p>设置首页</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!--web.xml--&gt;</span>
<span class="token comment">&lt;!--    设置欢迎页面--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>welcome-file-list</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>welcome-file</span><span class="token punctuation">&gt;</span></span>login.jsp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>welcome-file</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>welcome-file-list</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>编写dao层用户登录的接口</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//获取登录的用户</span>
<span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getLoginUser</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span> <span class="token class-name">String</span> userCode<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>实现第三步的接口</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>user</span><span class="token punctuation">;</span>


<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">BaseDao</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">Connection</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">PreparedStatement</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">ResultSet</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">SQLException</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">BaseDao</span><span class="token punctuation">.</span>closeResource<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">BaseDao</span><span class="token punctuation">.</span>query<span class="token punctuation">;</span>


<span class="token comment">/**
 * @author ShmeBluk
 * @version 1.0
 * @ClassName: UserDAOImpl
 * @Desc: 针对user数据表操作的具体实现类
 * @package com.shme.dao
 * @project smbms
 * @date 2020/6/23 9:52
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDaoImp1</span> <span class="token keyword">implements</span> <span class="token class-name">UserDao</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getLoginUser</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span> <span class="token class-name">String</span> userCode<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>

        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;select * from smbms_user where userCode=?&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">ResultSet</span> rs<span class="token operator">=</span><span class="token class-name">BaseDao</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>sql<span class="token punctuation">,</span>userCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>conn<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                user<span class="token punctuation">.</span><span class="token function">setUserCode</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;userCode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                user<span class="token punctuation">.</span><span class="token function">setUserName</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;userName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                user<span class="token punctuation">.</span><span class="token function">setUserPassword</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;userPassword&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                user<span class="token punctuation">.</span><span class="token function">setGender</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">&quot;gender&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                user<span class="token punctuation">.</span><span class="token function">setBirthday</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token string">&quot;birthday&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                user<span class="token punctuation">.</span><span class="token function">setPhone</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;phone&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                user<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;address&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                user<span class="token punctuation">.</span><span class="token function">setUserRole</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">&quot;userRole&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                user<span class="token punctuation">.</span><span class="token function">setCreatedBy</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">&quot;createdBy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                user<span class="token punctuation">.</span><span class="token function">setCreationDate</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getTimestamp</span><span class="token punctuation">(</span><span class="token string">&quot;creationDate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                user<span class="token punctuation">.</span><span class="token function">setModifyBy</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">&quot;modifyBy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                user<span class="token punctuation">.</span><span class="token function">setModifyDate</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getTimestamp</span><span class="token punctuation">(</span><span class="token string">&quot;modifyDate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">BaseDao</span><span class="token punctuation">.</span><span class="token function">closeResource</span><span class="token punctuation">(</span>rs<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> user<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>业务层(service)接口</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//用户登录接口</span>
<span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">String</span> userCode<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>业务层实现</p></li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>service<span class="token punctuation">.</span>user</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">BaseDao</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>user<span class="token punctuation">.</span></span><span class="token class-name">UserDao</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>user<span class="token punctuation">.</span></span><span class="token class-name">UserDaoImp1</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">Connection</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">SQLException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImp1</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span><span class="token punctuation">{</span>

    <span class="token comment">//业务层会引用dao层，所以要调入dao层</span>
    <span class="token keyword">private</span> <span class="token class-name">UserDao</span> userDao<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">UserServiceImp1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        userDao<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">UserDaoImp1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @Desc 通过传入的用户名查询数据库中的信息
     * @param userCode 用户名(英文缩写)
     * @return User 数据库中查到的用户
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">String</span> userCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Connection</span> connection<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span><span class="token punctuation">{</span>
            connection<span class="token operator">=</span> <span class="token class-name">BaseDao</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            user<span class="token operator">=</span>userDao<span class="token punctuation">.</span><span class="token function">getLoginUser</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span>userCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> <span class="token operator">|</span> <span class="token class-name">SQLException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token class-name">BaseDao</span><span class="token punctuation">.</span><span class="token function">closeResource</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> user<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><ol start="8"><li><p>编写Servlet（控制层，调用业务层代码）</p> <blockquote><p>登录功能</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>user</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>service<span class="token punctuation">.</span>user<span class="token punctuation">.</span></span><span class="token class-name">UserService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>service<span class="token punctuation">.</span>user<span class="token punctuation">.</span></span><span class="token class-name">UserServiceImp1</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Constants</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServlet</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//获取用户名和密码</span>
        <span class="token class-name">String</span> userCode<span class="token operator">=</span>req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;userCode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> password<span class="token operator">=</span>req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;userPassword&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;前端:&quot;</span><span class="token operator">+</span>userCode<span class="token operator">+</span><span class="token string">&quot;:&quot;</span><span class="token operator">+</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//和数据库中的密码进行比较，调用业务层</span>
        <span class="token class-name">UserService</span> userService<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">UserServiceImp1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user<span class="token operator">=</span>userService<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>userCode<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//查询用户</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;数据库:&quot;</span><span class="token operator">+</span>user<span class="token punctuation">.</span><span class="token function">getUserCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;:&quot;</span><span class="token operator">+</span>user<span class="token punctuation">.</span><span class="token function">getUserPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//将用户的信息放入Session</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>password<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUserPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>USER_SESSION<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
                resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">&quot;jsp/frame.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;登录成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span><span class="token punctuation">{</span>
                req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;密码错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                req<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">&quot;login.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;密码错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span><span class="token punctuation">{</span>
            req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;用户不存在&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            req<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">&quot;login.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;用户不存在&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token function">doGet</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>注册功能</p></blockquote></li> <li><p>测试</p></li></ol> <h3 id="可能遇到的问题"><a href="#可能遇到的问题" class="header-anchor">#</a> 可能遇到的问题</h3> <p>Could not initialize class dao.BaseDao。实际表现为登录后反馈500。</p> <p>可参考博客：https://blog.csdn.net/GodGump/article/details/109348414?spm=1001.2101.3001.6650.4&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-4.pc_relevant_default&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-4.pc_relevant_default&amp;utm_relevant_index=6</p> <h2 id="注销功能"><a href="#注销功能" class="header-anchor">#</a> 注销功能</h2> <blockquote><p>logoutServlet.java</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>user</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Constants</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServlet</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogoutServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>USER_SESSION<span class="token punctuation">)</span><span class="token punctuation">;</span>
        resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getContextPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;/login.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token function">doGet</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>web.xml</p></blockquote> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!--退出请求注册--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">&gt;</span></span>logoutServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">&gt;</span></span>com.infinite.servlet.user.LogoutServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">&gt;</span></span>logoutServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">&gt;</span></span>/jsp/logout.do<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="登录拦截优化"><a href="#登录拦截优化" class="header-anchor">#</a> 登录拦截优化</h3> <blockquote><p>SysFilter.java</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>filter</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Constants</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SysFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">FilterConfig</span> filterConfig<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;SysFilter初始化&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        <span class="token class-name">HttpServletRequest</span> req<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> request<span class="token punctuation">;</span>
        <span class="token class-name">HttpServletResponse</span> resp<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">)</span> response<span class="token punctuation">;</span>
        <span class="token class-name">User</span> user<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span>req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>USER_SESSION<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>user<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getContextPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;/error/403.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;用户未登录&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;用户已登录&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;SysFilter已过滤&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;SysFilter销毁&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>web.xml</p></blockquote> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!--登陆过滤器--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">&gt;</span></span>sysFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-class</span><span class="token punctuation">&gt;</span></span>com.infinite.filter.SysFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-class</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-mapping</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">&gt;</span></span>sysFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">&gt;</span></span>/jsp/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-mapping</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="修改密码"><a href="#修改密码" class="header-anchor">#</a> 修改密码</h2> <ol><li><p>导入相关的前端素材</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${pageContext.request.contextPath }/jsp/pwdmodify.jsp<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>密码修改<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>写项目时，建议从底层向上写（如Dao--&gt;Service--&gt;Servlet）</p></li> <li><p>UserDao层</p> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">updatePassword</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> comm<span class="token punctuation">,</span><span class="token class-name">String</span> newPassword<span class="token punctuation">,</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>UserDao实现</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//UserDaoImp1.java</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">updatePassword</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span> <span class="token class-name">String</span> newPassword<span class="token punctuation">,</span> <span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> sql<span class="token operator">=</span><span class="token string">&quot;update `smbms_user` set `userPassword`=? where `id`=?&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> update<span class="token operator">=</span><span class="token class-name">BaseDao</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>sql<span class="token punctuation">,</span>newPassword<span class="token punctuation">,</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> update<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>UserServive层</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">updatePassword</span><span class="token punctuation">(</span><span class="token class-name">String</span> newPassword<span class="token punctuation">,</span> <span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>UserService实现</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//UserServiceImp1.java</span>
<span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">updatePassword</span><span class="token punctuation">(</span><span class="token class-name">String</span> newPassword<span class="token punctuation">,</span> <span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Boolean</span> flag<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token class-name">Connection</span> conn<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> update<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span><span class="token punctuation">{</span>
        conn<span class="token operator">=</span><span class="token class-name">BaseDao</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        update<span class="token operator">=</span>userDao<span class="token punctuation">.</span><span class="token function">updatePassword</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>newPassword<span class="token punctuation">,</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>update<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            flag<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">BaseDao</span><span class="token punctuation">.</span><span class="token function">closeResource</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> flag<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>UserServlet层（通过将常用代码片段提取成新方法，实现代码复用）</p> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">updatePassword</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span><span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span><span class="token punctuation">{</span>
     <span class="token class-name">Object</span> o<span class="token operator">=</span>req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>USER_SESSION<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name">String</span> newPassword<span class="token operator">=</span>req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;newpassword&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token keyword">boolean</span> flag<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>

     <span class="token keyword">if</span><span class="token punctuation">(</span>o<span class="token operator">!=</span><span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> newPassword<span class="token operator">!=</span><span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> newPassword<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
         <span class="token class-name">UserService</span> userService<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">UserServiceImp1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         flag<span class="token operator">=</span>userService<span class="token punctuation">.</span><span class="token function">updatePassword</span><span class="token punctuation">(</span>newPassword<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span>o<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">{</span>
             req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>MSG<span class="token punctuation">,</span><span class="token string">&quot;密码修改成功，请重新登录。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>USER_SESSION<span class="token punctuation">)</span><span class="token punctuation">;</span>
             resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getContextPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;/relogin.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;密码修改成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token keyword">return</span> <span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">else</span><span class="token punctuation">{</span>
             req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>MSG<span class="token punctuation">,</span><span class="token string">&quot;密码修改失败，请使用原密码登录。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">else</span><span class="token punctuation">{</span>
         req<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">&quot;/jsp/pwdmodify.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;密码修改失败。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre></div></li></ol> <h3 id="使用ajax优化密码修改功能"><a href="#使用ajax优化密码修改功能" class="header-anchor">#</a> 使用Ajax优化密码修改功能</h3> <blockquote><p>js/pwdmodify.js</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> oldpassword <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> newpassword <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> rnewpassword <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> saveBtn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	oldpassword <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#oldpassword&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	newpassword <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#newpassword&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	rnewpassword <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#rnewpassword&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	saveBtn <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#save&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	newpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	rnewpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	oldpassword<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;blur&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			<span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span>
			<span class="token literal-property property">url</span><span class="token operator">:</span>path<span class="token operator">+</span><span class="token string">&quot;/jsp/user.do&quot;</span><span class="token punctuation">,</span>
			<span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">method</span><span class="token operator">:</span><span class="token string">&quot;pwdmodify&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">oldpassword</span><span class="token operator">:</span>oldpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">//ajax传递的参数</span>
			<span class="token literal-property property">dataType</span><span class="token operator">:</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span>   <span class="token comment">//目前比较主流的前后端交互方式</span>
			<span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>result <span class="token operator">==</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//旧密码正确</span>
					<span class="token function">validateTip</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string-property property">&quot;color&quot;</span><span class="token operator">:</span><span class="token string">&quot;green&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>imgYes<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>result <span class="token operator">==</span> <span class="token string">&quot;false&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//旧密码输入不正确</span>
					<span class="token function">validateTip</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string-property property">&quot;color&quot;</span><span class="token operator">:</span><span class="token string">&quot;red&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">&quot; 原密码输入不正确&quot;</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>result <span class="token operator">==</span> <span class="token string">&quot;errorSession&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//当前用户session过期，请重新登录</span>
					<span class="token function">validateTip</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string-property property">&quot;color&quot;</span><span class="token operator">:</span><span class="token string">&quot;red&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">&quot; 当前用户session过期，请重新登录&quot;</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>result <span class="token operator">==</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//旧密码输入为空</span>
					<span class="token function">validateTip</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string-property property">&quot;color&quot;</span><span class="token operator">:</span><span class="token string">&quot;red&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">&quot; 请输入旧密码&quot;</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function-variable function">error</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token comment">//请求出错</span>
				<span class="token function">validateTip</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string-property property">&quot;color&quot;</span><span class="token operator">:</span><span class="token string">&quot;red&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">&quot; 请求错误&quot;</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;focus&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">validateTip</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string-property property">&quot;color&quot;</span><span class="token operator">:</span><span class="token string">&quot;#666666&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;* 请输入原密码&quot;</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	newpassword<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;focus&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">validateTip</span><span class="token punctuation">(</span>newpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string-property property">&quot;color&quot;</span><span class="token operator">:</span><span class="token string">&quot;#666666&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;* 密码长度必须是大于6小于20&quot;</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;blur&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>newpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> newpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> <span class="token number">6</span>
				<span class="token operator">&amp;&amp;</span> newpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">20</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">validateTip</span><span class="token punctuation">(</span>newpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string-property property">&quot;color&quot;</span><span class="token operator">:</span><span class="token string">&quot;green&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>imgYes<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
			<span class="token function">validateTip</span><span class="token punctuation">(</span>newpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string-property property">&quot;color&quot;</span><span class="token operator">:</span><span class="token string">&quot;red&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">&quot; 密码输入不符合规范，请重新输入&quot;</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	
	rnewpassword<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;focus&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">validateTip</span><span class="token punctuation">(</span>rnewpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string-property property">&quot;color&quot;</span><span class="token operator">:</span><span class="token string">&quot;#666666&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;* 请输入与上面一致的密码&quot;</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;blur&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>rnewpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> rnewpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> <span class="token number">6</span>
				<span class="token operator">&amp;&amp;</span> rnewpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">20</span> <span class="token operator">&amp;&amp;</span> newpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> rnewpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">validateTip</span><span class="token punctuation">(</span>rnewpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string-property property">&quot;color&quot;</span><span class="token operator">:</span><span class="token string">&quot;green&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>imgYes<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
			<span class="token function">validateTip</span><span class="token punctuation">(</span>rnewpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string-property property">&quot;color&quot;</span><span class="token operator">:</span><span class="token string">&quot;red&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">&quot; 两次密码输入不一致，请重新输入&quot;</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	
	saveBtn<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		oldpassword<span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		newpassword<span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		rnewpassword<span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>
			oldpassword<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;validateStatus&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;true&quot;</span> <span class="token operator">&amp;&amp;</span>
			newpassword<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;validateStatus&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;true&quot;</span>
			<span class="token operator">&amp;&amp;</span> rnewpassword<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;validateStatus&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">&quot;确定要修改密码？&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#userForm&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>fastjson依赖</p></blockquote> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!--fastjson--&gt;</span>
<span class="token comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/fastjson --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.62<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>UserServlet层</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">modifyPassword</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span><span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">{</span>
    <span class="token class-name">User</span> o<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span>req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>USER_SESSION<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> oldpassword<span class="token operator">=</span>req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;oldpassword&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Session中的密码:&quot;</span> <span class="token operator">+</span> o<span class="token punctuation">.</span><span class="token function">getUserPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;用户输入的旧密码:&quot;</span> <span class="token operator">+</span> oldpassword<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span> <span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> resultMap<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>o<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        resultMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;result&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;errorSession&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNullOrEmpty</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        resultMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;result&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">getUserPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            resultMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;result&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span><span class="token punctuation">{</span>
            resultMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;result&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;false&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//设置返回json字符串</span>
    resp<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">PrintWriter</span> out<span class="token operator">=</span>resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">JSONArray</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>resultMap<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="用户管理功能"><a href="#用户管理功能" class="header-anchor">#</a> 用户管理功能</h2> <p>图示：</p> <p><img alt="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/ed0ffca7647545ed9e10d925c442e753.png?x-oss-process=image" loading="lazy" class="lazy"></p> <ol><li><p>导入分页的工具类</p> <blockquote><p>com.infinite.util.PageSupport.java</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>util</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PageSupport</span> <span class="token punctuation">{</span>

    <span class="token comment">//数据库中数据总条目数</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> totalDataNumber<span class="token punctuation">;</span>

    <span class="token comment">//当前页码</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> currentPageCode<span class="token punctuation">;</span>

    <span class="token comment">//每页显示条目数(页面大小)</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> pageSize<span class="token punctuation">;</span>

    <span class="token comment">//总页数</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token class-name">PageNumber</span><span class="token punctuation">;</span>


    <span class="token comment">//页码getter</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getCurrentPageCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> currentPageCode<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//页码setter</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCurrentPageCode</span><span class="token punctuation">(</span><span class="token keyword">int</span> currentPageCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//判断输入页码是否大于0</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>currentPageCode <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> currentPageCode <span class="token operator">&lt;=</span> <span class="token class-name">PageNumber</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>currentPageCode <span class="token operator">=</span> currentPageCode<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">//页面大小getter</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getPageSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> pageSize<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//页面大小setter</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPageSize</span><span class="token punctuation">(</span><span class="token keyword">int</span> pageSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//判断页面大小是否大于零</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pageSize <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>pageSize <span class="token operator">=</span> pageSize<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">//页数getter</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getPageNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">PageNumber</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//页数setter</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPageNumber</span><span class="token punctuation">(</span><span class="token keyword">int</span> pageNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">PageNumber</span> <span class="token operator">=</span> pageNumber<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">//数据总数getter</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getTotalDataNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> totalDataNumber<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//数据总数setter</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTotalDataNumber</span><span class="token punctuation">(</span><span class="token keyword">int</span> totalDataNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//判断totalDataNumber是否大于零</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>totalDataNumber <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>totalDataNumber <span class="token operator">=</span> totalDataNumber<span class="token punctuation">;</span>
            <span class="token function">setPageNumberByRs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">//计算查询的数据能够显示的总页数</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPageNumberByRs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">//判断是否定义了pageSize</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pageSize <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">/**
             * 能走到这里说明`totalDataNumber&gt;0&amp;&amp;pageSize&gt;0`
             * 那么相除的结果:要么为零,要么大于零
             */</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>totalDataNumber <span class="token operator">%</span> pageSize <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//刚好除尽</span>
                <span class="token class-name">PageNumber</span> <span class="token operator">=</span> totalDataNumber <span class="token operator">/</span> pageSize<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span><span class="token comment">/* (totalDataNumber % pageSize &gt; 0) */</span><span class="token punctuation">{</span> <span class="token comment">//有余数,总页数加一页</span>
                <span class="token class-name">PageNumber</span> <span class="token operator">=</span> <span class="token punctuation">(</span>totalDataNumber <span class="token operator">/</span> pageSize<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">PageNumber</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>导入用户列表页面</p></li></ol> <h3 id="_1、获取用户数量"><a href="#_1、获取用户数量" class="header-anchor">#</a> 1、获取用户数量</h3> <ol><li><p>UserDao</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getUserCount</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span> <span class="token class-name">String</span> userName<span class="token punctuation">,</span> <span class="token keyword">int</span> userRole<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>UserDaoImp1</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getUserCount</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span> <span class="token class-name">String</span> userName<span class="token punctuation">,</span> <span class="token keyword">int</span> userRole<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
    <span class="token class-name">StringBuffer</span> sql<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;select count(1) as count from smbms_user u , smbms_role r where u.userRole=r.id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//若存在用户名筛选条件</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNullOrEmpty</span><span class="token punctuation">(</span>userName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot; and u.userName like ?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userName<span class="token operator">=</span><span class="token string">&quot;%&quot;</span><span class="token operator">+</span>userName<span class="token operator">+</span><span class="token string">&quot;%&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;userName: &quot;</span><span class="token operator">+</span>userName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//若存在角色筛选条件</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>userRole<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot; and u.userRole = ?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;UserDaoImpl-&gt;getUserCount():&quot;</span> <span class="token operator">+</span> sql<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">ResultSet</span> rs<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNullOrEmpty</span><span class="token punctuation">(</span>userName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>userRole<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//用户和角色都存在</span>
        rs<span class="token operator">=</span><span class="token function">query</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>sql<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>userName<span class="token punctuation">,</span>userRole<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;情况一&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNullOrEmpty</span><span class="token punctuation">(</span>userName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>userRole <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//用户名存在,用户角色不存在</span>
        rs <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> sql<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;情况二&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> 
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNullOrEmpty</span><span class="token punctuation">(</span>userName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>userRole <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//用户名不存在,用户角色存在</span>
        rs <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> sql<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userRole<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;情况三&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> 
    <span class="token keyword">else</span> <span class="token comment">/*((StringUtils.isNullOrEmpty(userName)) &amp;&amp; (userRole &lt; 0))*/</span> <span class="token punctuation">{</span> <span class="token comment">//用户名和用户角色都不存在</span>
        rs <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> sql<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;情况四&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//获得符合条件的用户个数</span>
    <span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        i<span class="token operator">=</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;rs中的个数: &quot;</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">closeResource</span><span class="token punctuation">(</span>rs<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> i<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>UserService</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">int</span> <span class="token function">getUserCount</span><span class="token punctuation">(</span><span class="token class-name">String</span> userName<span class="token punctuation">,</span><span class="token keyword">int</span> userRole<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>UserServiceImp1</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getUserCount</span><span class="token punctuation">(</span><span class="token class-name">String</span> userName<span class="token punctuation">,</span> <span class="token keyword">int</span> userRole<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">Connection</span> conn<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span><span class="token punctuation">{</span>
        conn<span class="token operator">=</span><span class="token class-name">BaseDao</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        count<span class="token operator">=</span>userDao<span class="token punctuation">.</span><span class="token function">getUserCount</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>userName<span class="token punctuation">,</span>userRole<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e1<span class="token punctuation">)</span><span class="token punctuation">{</span>
        e1<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e2<span class="token punctuation">)</span><span class="token punctuation">{</span>
        e2<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token class-name">BaseDao</span><span class="token punctuation">.</span><span class="token function">closeResource</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> count<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <h3 id="_2、获取用户列表"><a href="#_2、获取用户列表" class="header-anchor">#</a> 2、获取用户列表</h3> <ol><li><p>UserDao</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserList</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span> <span class="token class-name">String</span> userName<span class="token punctuation">,</span> <span class="token keyword">int</span> userRole<span class="token punctuation">,</span> <span class="token keyword">int</span> currentPageCode<span class="token punctuation">,</span> <span class="token keyword">int</span> pageSize<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>UserDaoImp1</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserList</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span> <span class="token class-name">String</span> userName<span class="token punctuation">,</span> <span class="token keyword">int</span> userRole<span class="token punctuation">,</span> <span class="token keyword">int</span> currentPageCode<span class="token punctuation">,</span> <span class="token keyword">int</span> pageSize<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
    <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">StringBuffer</span> sql <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;select u.*,r.roleName as userRoleName from smbms_user u,smbms_role r where u.userRole=r.id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//如果有用户名筛选条件</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNullOrEmpty</span><span class="token punctuation">(</span>userName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot; and u.userName like ?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userName <span class="token operator">=</span> <span class="token string">&quot;%&quot;</span> <span class="token operator">+</span> userName <span class="token operator">+</span> <span class="token string">&quot;%&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//如果有角色筛选条件</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>userRole <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot; and u.userRole=?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//单页记录数</span>
    <span class="token keyword">int</span> offset <span class="token operator">=</span> <span class="token punctuation">(</span>currentPageCode <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> pageSize<span class="token punctuation">;</span>
    sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot; order by r.id limit ?,?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">ResultSet</span> rs<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNullOrEmpty</span><span class="token punctuation">(</span>userName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>userRole <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//用户名和用户角色都存在</span>
        rs <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> sql<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userName<span class="token punctuation">,</span> userRole<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;情况一&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;sql:&quot;</span> <span class="token operator">+</span> sql<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;用户名:&quot;</span> <span class="token operator">+</span> userName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;用户角色:&quot;</span> <span class="token operator">+</span> userRole<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;起始索引:&quot;</span> <span class="token operator">+</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;页面大小:&quot;</span> <span class="token operator">+</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNullOrEmpty</span><span class="token punctuation">(</span>userName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>userRole <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//用户名存在,用户角色不存在</span>
        rs <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> sql<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userName<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;情况二&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;sql:&quot;</span> <span class="token operator">+</span> sql<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;用户名:&quot;</span> <span class="token operator">+</span> userName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;起始索引:&quot;</span> <span class="token operator">+</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;页面大小:&quot;</span> <span class="token operator">+</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNullOrEmpty</span><span class="token punctuation">(</span>userName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>userRole <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//用户名不存在,用户角色存在</span>
        rs <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> sql<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userRole<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;情况三&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;sql:&quot;</span> <span class="token operator">+</span> sql<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;用户角色:&quot;</span> <span class="token operator">+</span> userRole<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;起始索引:&quot;</span> <span class="token operator">+</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;页面大小:&quot;</span> <span class="token operator">+</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token comment">/*((StringUtils.isNullOrEmpty(userName)) &amp;&amp; (userRole &lt; 0))*/</span> <span class="token punctuation">{</span> <span class="token comment">//用户名和用户角色都不存在</span>
        rs <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> sql<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> offset<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;情况四&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;sql:&quot;</span> <span class="token operator">+</span> sql<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;起始索引:&quot;</span> <span class="token operator">+</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;页面大小:&quot;</span> <span class="token operator">+</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setUserCode</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;userCode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setUserName</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;userName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setGender</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">&quot;gender&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setBirthday</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token string">&quot;birthday&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setPhone</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;phone&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setUserRole</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">&quot;userRole&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setUserRoleName</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;userRoleName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">BaseDao</span><span class="token punctuation">.</span><span class="token function">closeResource</span><span class="token punctuation">(</span>rs<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> userList<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>UserService</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserList</span><span class="token punctuation">(</span><span class="token class-name">String</span> userName<span class="token punctuation">,</span> <span class="token keyword">int</span> userRole<span class="token punctuation">,</span> <span class="token keyword">int</span> currentPageCode<span class="token punctuation">,</span> <span class="token keyword">int</span> pageSize<span class="token punctuation">)</span>
</code></pre></div></li> <li><p>UserServiceImp1</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserList</span><span class="token punctuation">(</span><span class="token class-name">String</span> userName<span class="token punctuation">,</span> <span class="token keyword">int</span> userRole<span class="token punctuation">,</span> <span class="token keyword">int</span> currentPageCode<span class="token punctuation">,</span> <span class="token keyword">int</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">Connection</span> conn<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span>userList<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span><span class="token punctuation">{</span>
        conn<span class="token operator">=</span><span class="token class-name">BaseDao</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>currentPageCode<span class="token operator">&gt;</span><span class="token number">0</span> <span class="token operator">&amp;&amp;</span> pageSize<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            userList<span class="token operator">=</span>userDao<span class="token punctuation">.</span><span class="token function">getUserList</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>userName<span class="token punctuation">,</span>userRole<span class="token punctuation">,</span>currentPageCode<span class="token punctuation">,</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e1<span class="token punctuation">)</span><span class="token punctuation">{</span>
        e1<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e2<span class="token punctuation">)</span><span class="token punctuation">{</span>
        e2<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token class-name">BaseDao</span><span class="token punctuation">.</span><span class="token function">closeResource</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> userList<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <h3 id="_3、获取角色操作"><a href="#_3、获取角色操作" class="header-anchor">#</a> 3、获取角色操作</h3> <p>角色相关的操作要另外写一个包，以实现职责统一</p> <ol><li><p>RoleDao</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>role</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Role</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">Connection</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">SQLException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">RoleDao</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 获取角色列表
     * @param conn Connection 数据库连接
     * @return List&lt;Role&gt; 角色集合
     */</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">&gt;</span></span> <span class="token function">getRoleList</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>RoleDaoImp1</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>role</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Role</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">Connection</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">ResultSet</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">SQLException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">BaseDao</span><span class="token punctuation">.</span>query<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RoleDaoImp1</span> <span class="token keyword">implements</span> <span class="token class-name">RoleDao</span><span class="token punctuation">{</span>
    <span class="token comment">/**
     * 获取角色列表
     * @param conn Connection 数据库连接
     * @return List&lt;Role&gt; 角色集合
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">&gt;</span></span> <span class="token function">getRoleList</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;select * from smbms_role&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">&gt;</span></span> roleList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">Role</span> role <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Role</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            role<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            role<span class="token punctuation">.</span><span class="token function">setRoleCode</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;roleCode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            role<span class="token punctuation">.</span><span class="token function">setRoleName</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;roleName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            roleList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>role<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> roleList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>RoleService</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>service<span class="token punctuation">.</span>role</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Role</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author ShmeBluk
 * @version 1.0
 * @ClassName: RoleService
 * @Desc: 角色service层接口
 * @package com.infinite.service
 * @project smbms
 * @date 2020/7/10 15:32
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">RoleService</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 获取用户角色列表
     * @return List&lt;Role&gt; 用户列表
     */</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">&gt;</span></span> <span class="token function">getRoleList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>RoleServiceImp1</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>service<span class="token punctuation">.</span>role</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">BaseDao</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>role<span class="token punctuation">.</span></span><span class="token class-name">RoleDao</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>role<span class="token punctuation">.</span></span><span class="token class-name">RoleDaoImp1</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>infinite<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Role</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">Connection</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">SQLException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RoleServiceImp1</span> <span class="token keyword">implements</span> <span class="token class-name">RoleService</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">RoleDao</span> roleDAO<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">RoleServiceImp1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        roleDAO <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RoleDaoImp1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取用户角色列表
     * @return List&lt;Role&gt; 用户列表
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">&gt;</span></span> <span class="token function">getRoleList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">&gt;</span></span> roleList <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            conn <span class="token operator">=</span> <span class="token class-name">BaseDao</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            roleList <span class="token operator">=</span> roleDAO<span class="token punctuation">.</span><span class="token function">getRoleList</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> throwables<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            throwables<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token class-name">BaseDao</span><span class="token punctuation">.</span><span class="token function">closeResource</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> roleList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <h3 id="_4、用户显示的servlet"><a href="#_4、用户显示的servlet" class="header-anchor">#</a> 4、用户显示的Servlet</h3> <ol><li>获取前端的数据</li> <li>通过传入参数判断请求是否需要执行</li> <li>为了实现分页，需要计算出当前页面和总页面、页面大小等</li> <li>用户列表展示</li> <li>返回到前端</li></ol> <blockquote><p>UserServlet.java</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
    <span class="token comment">//从请求中获取参数</span>
    <span class="token class-name">String</span> queryName<span class="token operator">=</span>req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;queryName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> pageIndex<span class="token operator">=</span>req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;pageIndex&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> temp<span class="token operator">=</span>req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;queryUserRole&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> queryUserRole<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">//初始化赋值，避免查询时出现异常</span>

    <span class="token comment">//页面大小</span>
    <span class="token keyword">int</span> pageSize<span class="token operator">=</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>PAGE_SIZE<span class="token punctuation">;</span>
    <span class="token comment">//当前页码</span>
    <span class="token keyword">int</span> currentPageCode<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token comment">//判断是否有用户名筛选</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>queryName<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//没有用户名限制，就赋值为空字符串，避免查询报错</span>
        queryName<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//判断是否有角色筛选</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>temp<span class="token operator">!=</span><span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>temp<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        queryUserRole<span class="token operator">=</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//判断传入页码是否正确</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>pageIndex<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span><span class="token punctuation">{</span>
            currentPageCode<span class="token operator">=</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>pageIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NumberFormatException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">&quot;error.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//获取符合条件的用户个数</span>
    <span class="token class-name">UserService</span> userService<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">UserServiceImp1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> totalDataNumber<span class="token operator">=</span>userService<span class="token punctuation">.</span><span class="token function">getUserCount</span><span class="token punctuation">(</span>queryName<span class="token punctuation">,</span>queryUserRole<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//计算数据显示的总页数</span>
    <span class="token class-name">PageSupport</span> pageSupport<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">PageSupport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pageSupport<span class="token punctuation">.</span><span class="token function">setCurrentPageCode</span><span class="token punctuation">(</span>currentPageCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    pageSupport<span class="token punctuation">.</span><span class="token function">setPageSize</span><span class="token punctuation">(</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    pageSupport<span class="token punctuation">.</span><span class="token function">setTotalDataNumber</span><span class="token punctuation">(</span>totalDataNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> pageNumber<span class="token operator">=</span>pageSupport<span class="token punctuation">.</span><span class="token function">getPageNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//总页数</span>

    <span class="token comment">//控制首页和尾页</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>currentPageCode<span class="token operator">&lt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        currentPageCode<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>currentPageCode<span class="token operator">&gt;</span>pageNumber<span class="token punctuation">)</span><span class="token punctuation">{</span>
        currentPageCode<span class="token operator">=</span>pageNumber<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//将查到的用户数据存入Attribute中</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userList<span class="token operator">=</span>userService<span class="token punctuation">.</span><span class="token function">getUserList</span><span class="token punctuation">(</span>queryName<span class="token punctuation">,</span>queryUserRole<span class="token punctuation">,</span>currentPageCode<span class="token punctuation">,</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> iterator<span class="token operator">=</span>userList<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">User</span> user<span class="token operator">=</span>iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;用户: &quot;</span><span class="token operator">+</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;userList&quot;</span><span class="token punctuation">,</span>userList<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//将查询到的角色数据存入Attribute中</span>
    <span class="token class-name">RoleService</span> roleService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RoleServiceImp1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">&gt;</span></span> roleList <span class="token operator">=</span> roleService<span class="token punctuation">.</span><span class="token function">getRoleList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Role</span> role <span class="token operator">:</span> roleList<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;用户角色:&quot;</span><span class="token operator">+</span>role<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;roleList&quot;</span><span class="token punctuation">,</span> roleList<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//将需要的参数存到Attribute中</span>
    req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;queryUserName&quot;</span><span class="token punctuation">,</span> queryName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;queryUserRole&quot;</span><span class="token punctuation">,</span> queryUserRole<span class="token punctuation">)</span><span class="token punctuation">;</span>
    req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;totalPageCount&quot;</span><span class="token punctuation">,</span> pageNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>
    req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;totalCount&quot;</span><span class="token punctuation">,</span> totalDataNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>
    req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;currentPageNo&quot;</span><span class="token punctuation">,</span> currentPageCode<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//转发:url不变</span>
    req<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">&quot;userlist.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>==后续的增删改等功能总体思想和查询一样==
ist = roleDAO.getRoleList(conn);
} catch (ClassNotFoundException e) {
e.printStackTrace();
} catch (SQLException throwables) {
throwables.printStackTrace();
} finally {
BaseDao.closeResource(null,null,conn);
}
return roleList;
}
}</p> <div class="language- extra-class"><pre class="language-text"><code>


### 4、用户显示的Servlet

1. 获取前端的数据
2. 通过传入参数判断请求是否需要执行
3. 为了实现分页，需要计算出当前页面和总页面、页面大小等
4. 用户列表展示
5. 返回到前端

&gt; UserServlet.java

```java
private void query(HttpServletRequest req, HttpServletResponse resp) throws IOException, ServletException {
 //从请求中获取参数
 String queryName=req.getParameter(&quot;queryName&quot;);
 String pageIndex=req.getParameter(&quot;pageIndex&quot;);
 String temp=req.getParameter(&quot;queryUserRole&quot;);
 int queryUserRole=0;  //初始化赋值，避免查询时出现异常

 //页面大小
 int pageSize=Constants.PAGE_SIZE;
 //当前页码
 int currentPageCode=1;

 //判断是否有用户名筛选
 if(queryName==null){
     //没有用户名限制，就赋值为空字符串，避免查询报错
     queryName=&quot;&quot;;
 }
 //判断是否有角色筛选
 if(temp!=null &amp;&amp; !temp.equals(&quot;&quot;)){
     queryUserRole=Integer.parseInt(temp);
 }
 //判断传入页码是否正确
 if(pageIndex!=null){
     try{
         currentPageCode=Integer.parseInt(pageIndex);
     }
     catch (NumberFormatException e){
         e.printStackTrace();
         resp.sendRedirect(&quot;error.jsp&quot;);
     }
 }

 //获取符合条件的用户个数
 UserService userService=new UserServiceImp1();
 int totalDataNumber=userService.getUserCount(queryName,queryUserRole);

 //计算数据显示的总页数
 PageSupport pageSupport=new PageSupport();
 pageSupport.setCurrentPageCode(currentPageCode);
 pageSupport.setPageSize(pageSize);
 pageSupport.setTotalDataNumber(totalDataNumber);

 int pageNumber=pageSupport.getPageNumber(); //总页数

 //控制首页和尾页
 if(currentPageCode&lt;1){
     currentPageCode=1;
 }
 else if(currentPageCode&gt;pageNumber){
     currentPageCode=pageNumber;
 }

 //将查到的用户数据存入Attribute中
 List&lt;User&gt; userList=userService.getUserList(queryName,queryUserRole,currentPageCode,pageSize);
 Iterator&lt;User&gt; iterator=userList.iterator();
 while(iterator.hasNext()){
     User user=iterator.next();
     System.out.println(&quot;用户: &quot;+user);
 }
 req.setAttribute(&quot;userList&quot;,userList);

 //将查询到的角色数据存入Attribute中
 RoleService roleService = new RoleServiceImp1();
 List&lt;Role&gt; roleList = roleService.getRoleList();
 for(Role role : roleList){
     System.out.println(&quot;用户角色:&quot;+role);
 }
 req.setAttribute(&quot;roleList&quot;, roleList);

 //将需要的参数存到Attribute中
 req.setAttribute(&quot;queryUserName&quot;, queryName);
 req.setAttribute(&quot;queryUserRole&quot;, queryUserRole);
 req.setAttribute(&quot;totalPageCount&quot;, pageNumber);
 req.setAttribute(&quot;totalCount&quot;, totalDataNumber);
 req.setAttribute(&quot;currentPageNo&quot;, currentPageCode);

 //转发:url不变
 req.getRequestDispatcher(&quot;userlist.jsp&quot;).forward(req, resp);
}
</code></pre></div><p>==后续的增删改等功能总体思想和查询一样==</p> <h1 id="注"><a href="#注" class="header-anchor">#</a> 注</h1> <p>着重理解javaweb的原理，后续学习框架（SSM，Spring等等）后，javaweb中的内容会被不断封装简化，需要写的代码量也会减少。</p></div> <div class="tail" data-v-3caaac61><div class="ending" data-v-3caaac61><span data-v-3caaac61>The post above ended</span> <i class="far fa-dot-circle fa-fw" data-v-3caaac61></i> <span data-v-3caaac61>Thanks for your reading</span></div> <div class="friend" data-v-3caaac61><div data-v-3caaac61>Come on! Write some comments, and your suggestions will improve the quality of my creative!</div> <div class="button" data-v-3caaac61>FRIEND ME</div> <div class="qrcode" data-v-3caaac61><div data-v-3caaac61><img src="/assets/img/qq.png" data-v-3caaac61> <div data-v-3caaac61>QQ</div></div><div data-v-3caaac61><img src="/assets/img/wechat.png" data-v-3caaac61> <div data-v-3caaac61>WeChat</div></div></div></div> <div class="share" data-v-3caaac61><!----></div> <div class="license" data-v-3caaac61><div class="frame" data-v-3caaac61><div data-v-3caaac61><span data-v-3caaac61>Post Author:</span> <a target="_blank" href="/" data-v-3caaac61>Mitchell</a></div> <div data-v-3caaac61><span data-v-3caaac61>Post Link:</span> <a target="_blank" href="/" data-v-3caaac61>/</a></div> <div data-v-3caaac61><span data-v-3caaac61>Copyright Notice:</span> <span data-v-3caaac61>All articles/posts in this website are licensed under <a target="_blank" href="//creativecommons.org/licenses/by-nc-sa/4.0/"><i class="fab fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally.</span></div></div></div> <div class="tags" data-v-3caaac61><a href="/tag/JavaWeb/" data-v-3caaac61># JavaWeb</a></div> <div class="pn" data-v-3caaac61><!----> <a href="/post/66dc079c48981e5faf9023d92c7c6d29/#" title="Newer Post: undefined" class="next" data-v-3caaac61></a></div></div> <div class="readmode" data-v-3caaac61><span data-v-3caaac61>Enable Read Mode</span> <i class="fas fa-book-open" data-v-3caaac61></i></div></div></div> <div class="Comment card" data-v-0b506543 data-v-55aed3a6><div class="caption" data-v-0b506543><span class="icon" data-v-0b506543><i class="fas fa-comments fa-fw" data-v-0b506543></i></span> <span data-v-0b506543>COMMENTS</span></div> <div class="inner" data-v-0b506543><!----></div> <div class="minimize" data-v-0b506543></div></div></div></div> <div class="Empty card" style="background-image:url('/assets/img/empty.png');" data-v-22aaa453 data-v-5f6ffb84></div></div> <div class="aside" data-v-5f6ffb84><div class="Aside" data-v-07032a5d data-v-5f6ffb84><div class="Panel" data-v-70581521 data-v-07032a5d><div class="card" data-v-70581521><div class="caption" data-v-70581521><span class="icon" data-v-70581521><i class="fas fa-folder-open fa-fw"></i></span> <span data-v-70581521>CATEGORIES</span></div> <div class="inner" data-v-70581521><a href="/category/语言/" style="font-size:1.1166666666666667rem;opacity:1;" data-v-70581521>语言</a><a href="/category/Blog/" style="font-size:0.9166666666666666rem;opacity:0.7272727272727273;" data-v-70581521>Blog</a><a href="/category/网络/" style="font-size:0.7833333333333333rem;opacity:0.5454545454545454;" data-v-70581521>网络</a><a href="/category/Note/" style="font-size:0.7833333333333333rem;opacity:0.5454545454545454;" data-v-70581521>Note</a><a href="/category/前端/" style="font-size:0.7833333333333333rem;opacity:0.5454545454545454;" data-v-70581521>前端</a><a href="/category/web开发/" style="font-size:0.8166666666666667rem;opacity:0.5909090909090909;" data-v-70581521>web开发</a><a href="/category/数据库/" style="font-size:0.8166666666666667rem;opacity:0.5909090909090909;" data-v-70581521>数据库</a><a href="/category/java框架/" style="font-size:0.7833333333333333rem;opacity:0.5454545454545454;" data-v-70581521>java框架</a><a href="/category/其他/" style="font-size:0.8166666666666667rem;opacity:0.5909090909090909;" data-v-70581521>其他</a><a href="/category/算法/" style="font-size:0.7833333333333333rem;opacity:0.5454545454545454;" data-v-70581521>算法</a><a href="/category/后端框架/" style="font-size:0.8166666666666667rem;opacity:0.5909090909090909;" data-v-70581521>后端框架</a><a href="/category/Spring/" style="font-size:0.8166666666666667rem;opacity:0.5909090909090909;" data-v-70581521>Spring</a><a href="/category/操作系统/" style="font-size:0.7833333333333333rem;opacity:0.5454545454545454;" data-v-70581521>操作系统</a><a href="/category/Plugin/" style="font-size:0.8166666666666667rem;opacity:0.5909090909090909;" data-v-70581521>Plugin</a><a href="/category/Hexo/" style="font-size:0.7833333333333333rem;opacity:0.5454545454545454;" data-v-70581521>Hexo</a></div> <!----> <div class="minimize" data-v-70581521></div></div><div class="card" data-v-70581521><div class="caption" data-v-70581521><span class="icon" data-v-70581521><i class="fas fa-tags fa-fw"></i></span> <span data-v-70581521>TAGS</span></div> <!----> <div class="inner" data-v-70581521><a href="/tag/2048/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>2048</a><a href="/tag/JavaSE/" style="font-size:1.0833333333333333rem;opacity:1;" data-v-70581521>JavaSE</a><a href="/tag/Test/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>Test</a><a href="/tag/HTTP/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>HTTP</a><a href="/tag/HTTPS/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>HTTPS</a><a href="/tag/Links/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>Links</a><a href="/tag/JavaScript/" style="font-size:0.85rem;opacity:0.65;" data-v-70581521>JavaScript</a><a href="/tag/JavaWeb/" style="font-size:0.8166666666666667rem;opacity:0.6;" data-v-70581521>JavaWeb</a><a href="/tag/JavaEE/" style="font-size:0.85rem;opacity:0.65;" data-v-70581521>JavaEE</a><a href="/tag/XML/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>XML</a><a href="/tag/vuepressBlog/" style="font-size:0.8166666666666667rem;opacity:0.6;" data-v-70581521>vuepressBlog</a><a href="/tag/娱乐/" style="font-size:0.8166666666666667rem;opacity:0.6;" data-v-70581521>娱乐</a><a href="/tag/高中回忆/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>高中回忆</a><a href="/tag/algorithm/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>algorithm</a><a href="/tag/操作系统/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>操作系统</a><a href="/tag/command/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>command</a><a href="/tag/数据库/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>数据库</a><a href="/tag/SQL/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>SQL</a><a href="/tag/C/C++/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>C/C++</a><a href="/tag/音乐播放器/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>音乐播放器</a><a href="/tag/old blog/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>old blog</a><a href="/tag/diary/" style="font-size:0.7833333333333333rem;opacity:0.55;" data-v-70581521>diary</a></div> <div class="minimize" data-v-70581521></div></div></div> <div class="Audioplayer card" data-v-18c8023d data-v-07032a5d><div class="caption" data-v-18c8023d><span class="icon" data-v-18c8023d><i class="fas fa-music fa-fw" data-v-18c8023d></i></span> <span data-v-18c8023d>PLAYLIST</span></div> <div class="inner" style="height:calc(297px + 90px);" data-v-18c8023d><meting-js server="netease"type="playlist"id="7256148570"theme="var(--link)"list-max-height="297px"></meting-js></div> <div class="minimize" data-v-18c8023d></div></div> <!----> <div class="Toc card" data-v-022f25d3 data-v-07032a5d data-v-07032a5d><div class="caption" data-v-022f25d3><span class="icon" data-v-022f25d3><i class="fas fa-bookmark fa-fw" data-v-022f25d3></i></span> <span data-v-022f25d3>TABLE OF CONTENTS</span></div> <div class="inner" data-v-022f25d3><div data-v-022f25d3><ul><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#javaweb-二">JavaWeb（二）</a></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#_8、jsp">8、JSP</a><ul><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#_8-1-jsp原理">8.1 JSP原理</a></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#_8-2-jsp基本语法">8.2 JSP基本语法</a><ul><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#_8-2-1-jsp表达式">8.2.1 jsp表达式</a></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#_8-2-2-jsp脚本片段">8.2.2 jsp脚本片段</a></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#_8-2-3-脚本片段再实现">8.2.3 脚本片段再实现</a></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#_8-2-4-jsp声明">8.2.4 jsp声明</a></li></ul></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#_8-3-jsp指令">8.3 jsp指令</a><ul><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#自定义错误页面">自定义错误页面</a></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#网页拼接">网页拼接</a></li></ul></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#_8-4-9个内置对象">8.4 9个内置对象</a></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#_8-5-jsp标签、jstl标签、el表达式">8.5 JSP标签、JSTL标签、EL表达式</a><ul><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#jsp表达式">jsp表达式</a></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#jstl标签">JSTL标签</a><ul><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#管理员登录">管理员登录</a></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#成绩评定">成绩评定</a></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#遍历数组">遍历数组</a></li></ul></li></ul></li></ul></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#_9、javabean">9、JavaBean</a></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#_10、mvc三层架构">10、MVC三层架构</a><ul><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#_10-1-早期的架构">10.1 早期的架构</a></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#_10-2、改进的mvc三层架构">10.2、改进的MVC三层架构</a></li></ul></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#_11、filter-过滤器">11、Filter（过滤器）</a><ul><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#_11-1-将消息过滤为utf-8编码">11.1 将消息过滤为utf-8编码</a></li></ul></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#_12、监听器">12、监听器</a><ul><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#查看同时在线人数">查看同时在线人数</a></li></ul></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#_13、过滤器、监听器的常见应用">13、过滤器、监听器的常见应用</a><ul><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#用户登录跳转">用户登录跳转</a><ul><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#sysfilter-java">SysFilter.java</a></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#loginservlet">LoginServlet</a></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#logoutservlet">LogoutServlet</a></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#login-jsp">login.jsp</a></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#error-jsp">error.jsp</a></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#sys-success-jsp">sys/success.jsp</a></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#web-xml">web.xml</a></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#测试效果">测试效果</a></li></ul></li></ul></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#_14、jdbc">14、JDBC</a><ul><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#_14-1、基本用法">14.1、基本用法</a></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#_14-2-预编译sql用法">14.2 预编译sql用法</a></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#junit单元测试">junit单元测试</a></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#事务">事务</a></li></ul></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#项目-超市订单管理系统-smbms">项目：超市订单管理系统（SMBMS）</a><ul><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#需求">需求</a></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#项目搭建准备工作">项目搭建准备工作</a></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#登录功能">登录功能</a><ul><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#可能遇到的问题">可能遇到的问题</a></li></ul></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#注销功能">注销功能</a><ul><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#登录拦截优化">登录拦截优化</a></li></ul></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#修改密码">修改密码</a><ul><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#使用ajax优化密码修改功能">使用Ajax优化密码修改功能</a></li></ul></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#用户管理功能">用户管理功能</a><ul><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#_1、获取用户数量">1、获取用户数量</a></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#_2、获取用户列表">2、获取用户列表</a></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#_3、获取角色操作">3、获取角色操作</a></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#_4、用户显示的servlet">4、用户显示的Servlet</a></li></ul></li></ul></li><li><a href="/post/66dc079c48981e5faf9023d92c7c6d29/#注">注</a></li></ul></div></div></div></div></div> <div class="footer" data-v-5f6ffb84><div data-v-5f6ffb84><div class="Footer" data-v-1e7563d3 data-v-5f6ffb84><div data-v-1e7563d3>© 2019 - 2022 Mitchell</div> <div data-v-1e7563d3></div> <div data-v-1e7563d3>Theme <a target="_blank" href="//github.com/jinyaoMa/vuepress-theme-mustom" title="vuepress-theme-mustom">Mustom</a> By <a target="_blank" href="//github.com/jinyaoMa" title="jinyaoMa">jinyaoMa</a></div> <div class="footerCount" data-v-1e7563d3><span title="Site total page views" data-v-1e7563d3><i class="fas fa-eye fa-fw" data-v-1e7563d3></i>
      ∞
    </span> <span title="Site total visitors" data-v-1e7563d3><i class="fas fa-user-tie fa-fw" data-v-1e7563d3></i>
      ∞
    </span> <span title="Site total word count" data-v-1e7563d3><i class="fas fa-file-word fa-fw" data-v-1e7563d3></i>
      130.2k
    </span></div> <div class="license" data-v-1e7563d3><a class="by-nc-sa" target="_blank" href="//creativecommons.org/licenses/by-nc-sa/4.0/" title="Creative Commons Attribution-Noncommercial-ShareAlike 4.0 International license"></a></div></div></div></div></div></div> <div class="Notification default hide" data-v-1c9c144c data-v-5f6ffb84><div class="frame" data-v-1c9c144c><div class="inner" data-v-1c9c144c><div class="icon" data-v-1c9c144c><i class="fas fa-exclamation-circle fa-fw"></i></div> <div class="msg" data-v-1c9c144c>DEFAULT</div></div></div></div></div><div class="global-ui"><!----><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;right:48px;bottom:0px;width:180px;height:270px;z-index:99999;opacity:1;pointer-events:none;"><canvas id="live2d_canvas" width="180" height="270" class="live2d_canvas" style="position:absolute;left:0px;top:0px;width:180px;height:270px;"></canvas></div></div></div>
    <script src="./assets/js/app.152d2abe.js" defer></script><script src="./assets/js/5.45f84343.js" defer></script><script src="./assets/js/23.1c3c301b.js" defer></script><script src="./assets/js/10.e02dcdbc.js" defer></script><script src="./assets/js/7.6b3198e2.js" defer></script>
  </body>
</html>
